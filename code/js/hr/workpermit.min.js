var wp_obj=null;$(document).ready(function(){$("#btnWPClear").button().bind("click",clearWorkPermit);$("#btnWPAdd").button().bind("click",addWorkPermit);$("#btnWPUpdate").button().bind("click",updateWorkPermit);$("#btnWPPrint").button().bind("click",printWorkPermit);$("#txtWPLevy").keypress(function(){numericInput(2,".",0,2)});$("#wp-tabs").tabs();$("#txtWPDesc").focus();$(window).resize(resizeWorkPermitGrid);resizeWorkPermitGrid();clearWorkPermit()});function resizeWorkPermitGrid(){var a=$("#sbg-center-panel").outerHeight()-$("#sbg-wp-entry").outerHeight()-55;$("div#sbg-wp-data").css("height",a+"px")}function clearWorkPermit(){$("#txtWPId").val("Auto");$("#txtWPDesc").val("");$("#txtWPLevy").val("");$("#wp-tabs").tabs("option","active",0);$("#txtWPDesc").focus();$("#btnWPUpdate").prop("disabled","disabled");$("#wp_err_mesg").text("");$("#wp_err_desc").hide();wp_obj=null}function updateWorkPermit(){saveWorkPermit(C_UPDATE)}function addWorkPermit(){saveWorkPermit(C_ADD)}function saveWorkPermit(b){if(validateWorkPermit()){var c={type:b,id:$("#txtWPId").val(),desc:$("#txtWPDesc").val(),levy:$("#txtWPLevy").val()};var a="request.pzx?c="+wp_url+"&d="+new Date().getTime();callServer(a,"json",c,onWorkPermitResponse,wp_obj)}}function printWorkPermit(){var a="report.pzx?c="+wp_url+"&d="+new Date().getTime();showReport(a)}function editWorkPermit(d,c){var b={type:C_GET,id:d};var a="request.pzx?c="+wp_url+"&d="+new Date().getTime();wp_obj=c;callServer(a,"json",b,showWorkPermit,c)}function deleteWorkPermit(d,c){if(confirm("Confirm you want to delete work permit id : "+d+"?")){var b={type:C_DELETE,id:d};var a="request.pzx?c="+wp_url+"&d="+new Date().getTime();callServer(a,"json",b,onWorkPermitResponse,c)}}function showWorkPermit(a,b){if(b.status==C_OK){$("#txtWPId").val(b.data.id);$("#txtWPDesc").val(b.data.desc);$("#txtWPLevy").val(b.data.levy);$("#btnWPUpdate").prop("disabled","");$("#txtWPDesc").focus()}else{showDialog("System Message",b.mesg)}}function onWorkPermitResponse(a,b){if(b.status==C_OK){if(b.type==C_ADD){$("#sbg-wp-table tr:first").after("<tr><td>"+b.data+"</td><td>"+$("#txtWPDesc").val()+"</td><td style='text-align:right'>"+$("#txtWPLevy").val()+"</td><td style='text-align:center'><a href='javascript:' onclick='editWorkPermit("+b.data+",this)'><img src='image/edit_16.png' title='Edit'></img></a></td><td style='text-align:center'><a href='javascript:' onclick='deleteWorkPermit("+b.data+",this)'><img src='image/delete_16.png' title='Delete'></img></a></td></tr>")}else{if(b.type==C_DELETE){$($(a).closest("tr")).remove()}else{if(b.type==C_UPDATE){$($(a).closest("tr")).children("td:eq(1)").html($("#txtWPDesc").val());$($(a).closest("tr")).children("td:eq(2)").html($("#txtWPLevy").val())}}}$("#sbg-popup-box").html(b.mesg);$("#sbg-popup-box").show();$("#sbg-popup-box").fadeOut(5000);clearWorkPermit()}else{showDialog("Error",b.mesg)}}function validateWorkPermit(){$("#wp_err_mesg").text("");if($("#txtWPDesc").blank()){$("#wp_err_desc").show();$("#txtWPDesc").focus();$("#wp_err_mesg").text("work permit description can not be blank.");return false}else{$("#wp_err_desc").hide()}return true};