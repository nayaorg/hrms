var dept_obj=null;$(document).ready(function(){$("#btnDeptClear").button().bind("click",clearDept);$("#btnDeptUpdate").button().bind("click",updateDept);$("#btnDeptAdd").button().bind("click",addDept);$("#btnDeptPrint").button().bind("click",printDept);$("#dept-tabs").tabs();$("#txtDeptDesc").focus();$(window).resize(resizeDeptGrid);resizeDeptGrid();clearDept()});function resizeDeptGrid(){var a=$("#sbg-center-panel").outerHeight()-$("#sbg-dept-entry").outerHeight()-55;$("div#sbg-dept-data").css("height",a+"px")}function clearDept(){$("#txtDeptId").val("Auto");$("#txtDeptDesc").val("");$("#txtDeptRef").val("");$("#dept-tabs").tabs("option","active",0);$("#txtDeptDesc").focus();$("#btnDeptUpdate").prop("disabled","disabled");$("#dept_err_mesg").text("");$("#dept_err_desc").hide();dept_obj=null}function updateDept(){saveDept(C_UPDATE)}function addDept(){saveDept(C_ADD)}function saveDept(b){if(validateDept()){var c={type:b,id:$("#txtDeptId").val(),desc:$("#txtDeptDesc").val(),refno:$("#txtDeptRef").val()};var a="request.pzx?c="+dept_url+"&d="+new Date().getTime();callServer(a,"json",c,onDeptResponse,dept_obj)}}function printDept(){var a="report.pzx?c="+dept_url+"&d="+new Date().getTime();showReport(a)}function editDept(d,c){var b={type:C_GET,id:d};var a="request.pzx?c="+dept_url+"&d="+new Date().getTime();dept_obj=c;callServer(a,"json",b,showDept,c)}function deleteDept(d,c){if(confirm("Confirm you want to delete department id : "+d+"?")){var b={type:C_DELETE,id:d};var a="request.pzx?c="+dept_url+"&d="+new Date().getTime();callServer(a,"json",b,onDeptResponse,c)}}function showDept(a,b){if(b.status==C_OK){$("#txtDeptId").val(b.data.id);$("#txtDeptDesc").val(b.data.desc);$("#txtDeptRef").val(b.data.refno);$("#btnDeptUpdate").prop("disabled","");$("#txtDeptDesc").focus()}else{showDialog("System Message",b.mesg)}}function onDeptResponse(a,b){if(b.status==C_OK){if(b.type==C_ADD){$("#sbg-dept-table tr:first").after("<tr><td>"+b.data+"</td><td>"+$("#txtDeptDesc").val()+"</td><td>"+$("#txtDeptRef").val()+"</td><td style='text-align:center'><a href='javascript:' onclick='editDept("+b.data+",this)'><img src='image/edit_16.png' title='Edit'></img></a></td><td style='text-align:center'><a href='javascript:' onclick='deleteDept("+b.data+",this)'><img src='image/delete_16.png' title='Delete'></img></a></td></tr>")}else{if(b.type==C_DELETE){$($(a).closest("tr")).remove()}else{if(b.type==C_UPDATE){$($(a).closest("tr")).children("td:eq(1)").html($("#txtDeptDesc").val());$($(a).closest("tr")).children("td:eq(2)").text($("#txtDeptRef").val())}}}$("#sbg-popup-box").html(b.mesg);$("#sbg-popup-box").show();$("#sbg-popup-box").fadeOut(10000);clearDept()}else{showDialog("Error",b.mesg)}}function validateDept(){$("#dept_err_mesg").text("");if($("#txtDeptDesc").blank()){$("#dept_err_desc").show();$("#txtDeptDesc").focus();$("#dept_err_mesg").text("department description can not be blank.");return false}else{$("#dept_err_desc").hide()}return true};