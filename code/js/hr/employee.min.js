var emp_obj=null;$(document).ready(function(){$("input").css("marginTop",0);$("input").css("marginBottom",0);$("select").css("marginTop",0);$("select").css("marginBottom",0);var a={dateFormat:"dd/mm/yy",appendText:"  dd/mm/yyyy",showOn:"button",buttonImage:"image/calendar.gif",buttonImageOnly:true};$("#txtEmpDob").datepicker(a);$("#txtEmpJoin").datepicker(a);$("#txtEmpResign").datepicker(a);$("#txtEmpPostal").keypress(function(){numericInput(0,"",0,0)});$("#btnEmpClear").button().bind("click",clearEmp);$("#btnEmpAdd").button().bind("click",addEmp);$("#btnEmpUpdate").button().bind("click",updateEmp);$("#btnEmpPrint").button().bind("click",printEmp);$("#txtEmpDob").keypress(function(){dateInput("/")});$("#txtEmpJoin").keypress(function(){dateInput("/")});$("#txtEmpResign").keypress(function(){dateInput("/")});$("#emp-tabs").tabs();$("#txtEmpName").focus();$(window).resize(resizeEmpGrid);resizeEmpGrid();clearEmp()});function resizeEmpGrid(){var a=$("#sbg-center-panel").outerHeight()-$("#sbg-emp-entry").outerHeight()-55;$("div#sbg-emp-data").css("height",a+"px")}function clearEmp(){$("#txtEmpId").val("Auto");$("#txtCode").val("");$("#txtEmpName").val("");$("#txtEmpNric").val("");$("#cobEmpIdType").val("1");$("#txtEmpEmail").val("");$("#txtEmpDob").val("");$("#txtEmpJoin").val("");$("#txtEmpResign").val("");$("#txtEmpHouseNo").val("");$("#txtEmpStreet").val("");$("#txtEmpLevel").val("");$("#txtEmpUnitNo").val("");$("#txtEmpPostal").val("");$("#txtEmpTel").val("");$("#txtEmpMobile").val("");$("#cobEmpDept").val("");$("#cobEmpType").val("");$("#cobEmpGender").val("M");$("#cobEmpMarital").val("0");$("#cobEmpNat").val("");$("#cobEmpJob").val("");$("#cobEmpCoy").val("");$("#cobEmpRace").val("");$("#cobEmpPermit").val("");$("#txtEmpRmks").val("");$("#emp-tabs").tabs("option","active",0);$("#txtEmpName").focus();$("#btnEmpUpdate").prop("disabled","disabled");$("#emp_err_dept").hide();$("#emp_err_nric").hide();$("#emp_err_name").hide();$("#emp_err_code").hide();$("#emp_err_coy").hide();$("#emp_err_race").hide();$("#emp_err_dob").hide();$("#emp_err_nat").hide();$("#emp_err_job").hide();$("#emp_err_type").hide();$("#emp_err_join").hide();$("#emp_err_resign").hide();$("#emp_err_mesg").text("");emp_obj=null}function updateEmp(){saveEmp(C_UPDATE)}function addEmp(){saveEmp(C_ADD)}function saveEmp(b){if(validateEmp()){var d="0";var c={type:b,id:$("#txtEmpId").val(),name:$("#txtEmpName").val(),code:$("#txtCode").val(),coy:$("#cobEmpCoy").val(),dept:$("#cobEmpDept").val(),emptype:$("#cobEmpType").val(),job:$("#cobEmpJob").val(),join:$("#txtEmpJoin").val(),resign:$("#txtEmpResign").val(),nric:$("#txtEmpNric").val(),gender:$("#cobEmpGender").val(),marital:$("#cobEmpMarital").val(),race:$("#cobEmpRace").val(),nat:$("#cobEmpNat").val(),dob:$("#txtEmpDob").val(),house:$("#txtEmpHouseNo").val(),street:$("#txtEmpStreet").val(),level:$("#txtEmpLevel").val(),unitno:$("#txtEmpUnitNo").val(),postal:$("#txtEmpPostal").val(),tel:$("#txtEmpTel").val(),mobile:$("#txtEmpMobile").val(),email:$("#txtEmpEmail").val(),rmks:$("#txtEmpRmks").val(),permit:$("#cobEmpPermit").val(),idtype:$("#cobEmpIdType").val(),refno:"",block:d};var a="request.pzx?c="+emp_url+"&d="+new Date().getTime();callServer(a,"json",c,onEmpResponse,emp_obj)}}function printEmp(){var a="report.pzx?c="+emp_url+"&d="+new Date().getTime();showReport(a)}function editEmp(d,c){var b={type:C_GET,id:d};var a="request.pzx?c="+emp_url+"&d="+new Date().getTime();emp_obj=c;callServer(a,"json",b,showEmp,c)}function deleteEmp(d,c){if(confirm("Confirm you want to delete employee id : "+d+"?")){var b={type:C_DELETE,id:d};var a="request.pzx?c="+emp_url+"&d="+new Date().getTime();callServer(a,"json",b,onEmpResponse,c)}}function showEmp(a,b){if(b.status==C_OK){$("#txtEmpId").val(b.data.id);$("#txtCode").val(b.data.code);$("#txtEmpName").val(b.data.name);$("#txtEmpNric").val(b.data.nric);$("#cobEmpIdType").val(b.data.idtype);$("#txtEmpEmail").val(b.data.email);$("#txtEmpDob").val(b.data.dob);$("#txtEmpJoin").val(b.data.join);$("#txtEmpResign").val(b.data.resign);$("#cobEmpDept").val(b.data.dept);$("#cobEmpType").val(b.data.emptype);$("#cobEmpCoy").val(b.data.coy);$("#cobEmpRace").val(b.data.race);$("#cobEmpNat").val(b.data.nat);$("#cobEmpGender").val(b.data.gender);$("#cobEmpMarital").val(b.data.marital);$("#cobEmpJob").val(b.data.job);$("#txtEmpHouseNo").val(b.data.house);$("#txtEmpStreet").val(b.data.street);$("#txtEmpLevel").val(b.data.level);$("#txtEmpUnitNo").val(b.data.unitno);$("#txtEmpPostal").val(b.data.postal);$("#txtEmpTel").val(b.data.tel);$("#txtEmpMobile").val(b.data.mobile);$("#txtEmpRmks").val(b.data.rmks);$("#cobEmpPermit").val(b.data.permit);$("#btnEmpUpdate").prop("disabled","");$("#txtEmpName").focus()}else{showDialog("System Message",b.mesg)}}function onEmpResponse(a,b){if(b.status==C_OK){if(b.type==C_ADD){$("#sbg-emp-table tr:first").after("<tr><td>"+b.data+"</td><td>"+$("#txtCode").val()+"</td><td>"+$("#txtEmpName").val()+"</td><td>"+$("#cobEmpCoy :selected").text()+"</td><td>"+$("#cobEmpDept :selected").text()+"</td><td style='text-align:center'><a href='javascript:' onclick='editEmp("+b.data+",this)'><img src='image/edit_16.png' title='Edit'></img></a></td><td style='text-align:center'><a href='javascript:' onclick='deleteEmp("+b.data+",this)'><img src='image/delete_16.png' title='Delete'></img></a></td></tr>")}else{if(b.type==C_DELETE){$($(a).closest("tr")).remove()}else{if(b.type==C_UPDATE){$($(a).closest("tr")).children("td:eq(1)").text($("#txtCode").val());$($(a).closest("tr")).children("td:eq(2)").text($("#txtEmpName").val());$($(a).closest("tr")).children("td:eq(3)").text($("#cobEmpCoy :selected").text());$($(a).closest("tr")).children("td:eq(4)").text($("#cobEmpDept :selected").text())}}}$("#sbg-popup-box").html(b.mesg);$("#sbg-popup-box").show();$("#sbg-popup-box").fadeOut(5000);clearEmp()}else{showDialog("Error",b.mesg)}}function validateEmp(){$("#emp_err_mesg").text("");if($("#txtEmpName").blank()){$("#emp_err_name").show();$("#txtEmpName").focus();$("#emp_err_mesg").text("Employee name can not be blank.");return false}else{$("#emp_err_name").hide()}if($("#txtCode").blank()){$("#emp_err_code").show();$("#txtCode").focus();$("#emp_err_mesg").text("Employee code can not be blank.");return false}else{$("#emp_err_code").hide()}if($("#cobEmpCoy").val()==""){$("#emp_err_coy").show();$("#cobEmpCoy").focus();$("#emp_err_mesg").text("You must assign a Company to this employee");return false}else{$("#emp_err_coy").hide()}if($("#txtEmpNric").blank()){$("#emp_err_nric").show();$("#txtEmpNric").focus();$("#emp_err_mesg").text("ID no can not be blank.");return false}else{$("#emp_err_nric").hide()}if($("#cobEmpDept").val()==""){$("#emp_err_dept").show();$("#cobEmpDept").focus();$("#emp_err_mesg").text("You must assign a Department to this employee");return false}else{$("#emp_err_dept").hide()}if($("#cobEmpRace").val()==""){$("#emp_err_race").show();$("#cobEmpRace").focus();$("#emp_err_mesg").text("You must assign a Race to this employee");return false}else{$("#emp_err_race").hide()}if($("#cobEmpNat").val()==""){$("#emp_err_nat").show();$("#cobEmpNat").focus();$("#emp_err_mesg").text("You must assign a Nationality to this employee");return false}else{$("#emp_err_nat").hide()}if($("#cobEmpJob").val()==""){$("#emp_err_job").show();$("#cobEmpJob").focus();$("#emp_err_mesg").text("You must assign a Job Title to this employee");return false}else{$("#emp_err_job").hide()}if($("#cobEmpType").val()==""){$("#emp_err_type").show();$("#cobEmpType").focus();$("#emp_err_mesg").text("You must assign a Employee Type to this employee");return false}else{$("#emp_err_type").hide()}if($("#txtEmpDob").blank()){$("#emp_err_dob").show();$("#txtEmpDob").focus();$("#emp_err_mesg").text("Date of Birth can not be blank.");return false}else{$("#emp_err_dob").hide()}if($("#txtEmpDob").validDate()){$("#emp_err_dob").hide()}else{$("#emp_err_dob").show();$("#txtEmpDob").focus();$("#emp_err_mesg").text("Invalid date entry for Date of Birth");return false}if($("#txtEmpJoin").val()!=""){if($("#txtEmpJoin").validDate()){$("#emp_err_join").hide()}else{$("#emp_err_join").show();$("#txtEmpJoin").focus();$("#emp_err_mesg").text("Invalid date entry for Join Date");return false}}if($("#txtEmpResign").val()!=""){if($("#txtEmpResign").validDate()){$("#emp_err_resign").hide()}else{$("#emp_err_resign").show();$("#txtEmpResign").focus();$("#emp_err_mesg").text("Invalid date entry for Resign Date");return false}}return true};