var coy_obj=null;$(document).ready(function(){$("input").css("marginTop",0);$("input").css("marginBottom",0);$("select").css("marginTop",0);$("select").css("marginBottom",0);$("#company-tabs").tabs();$("#btnCoyClear").button().bind("click",clearCompany);$("#btnCoyUpdate").button().bind("click",updateCompany);$("#btnCoyAdd").button().bind("click",addCompany);$("#btnCoyPrint").button().bind("click",printCompany);$("#txtCoyCpfRef").keypress(function(){numericInput(0,"",0,0)});$("#txtCoyEgm").keypress(function(){numericInput(0,"",0,0)});$("#txtCoyBonus").keypress(function(){numericInput(0,"",0,0)});$(window).resize(resizeCoyGrid);resizeCoyGrid();clearCompany()});function resizeCoyGrid(){var a=$("#sbg-center-panel").outerHeight()-$("#sbg-company-entry").outerHeight()-55;$("div#sbg-company-data").css("height",a+"px")}function clearCompany(){$("#txtCoyId").val("Auto");$("#txtCoyName").val("");$("#txtCoyRef").val("");$("#cobCoyBank").val("");$("#txtCoyAcctNo").val("");$("#txtCoyTel").val("");$("#txtCoyFax").val("");$("#txtCoyAddr1").val("");$("#txtCoyAddr2").val("");$("#txtCoyAddr3").val("");$("#txtCoyAddr4").val("");$("#txtCoyAddr5").val("");$("#txtCoyRegNo").val("");$("#cobCoyRegType").val("");$("#txtCoyCpfNo").val("");$("#txtCoyCpfRef").val("");$("#txtCoyAuthName").val("");$("#txtCoyAuthTitle").val("");$("#txtCoyEgm").val("");$("#txtCoyBonus").val("");$("#txtCoyAuthTel").val("");$("#company-tabs").tabs("option","active",0);$("#txtCoyName").focus();$("#btnCoyUpdate").prop("disabled","disabled");$("#coy_err_name").hide();$("#coy_err_cpfno").hide();$("#coy_err_regtype").hide();$("#coy_err_regno").hide();$("#coy_err_cpfref").hide();$("#coy_err_authname").hide();$("#coy_err_mesg").text("");coy_obj=null}function updateCompany(){saveCompany(C_UPDATE)}function addCompany(){saveCompany(C_ADD)}function saveCompany(b){if(validateCompany()){var c={type:b,id:$("#txtCoyId").val(),name:$("#txtCoyName").val(),name2:"",regno:$("#txtCoyRegNo").val(),cpfno:$("#txtCoyCpfNo").val(),cpfref:$("#txtCoyCpfRef").val(),bank:$("#cobCoyBank").val(),acctno:$("#txtCoyAcctNo").val(),regtype:$("#cobCoyRegType").val(),refno:$("#txtCoyRef").val(),authname:$("#txtCoyAuthName").val(),authtitle:$("#txtCoyAuthTitle").val(),authtelno:$("#txtCoyAuthTel").val(),egmdate:$("#txtCoyEgm").val(),bonusdate:$("#txtCoyBonus").val(),tel:$("#txtCoyTel").val(),fax:$("#txtCoyFax").val(),addr1:$("#txtCoyAddr1").val(),addr2:$("#txtCoyAddr2").val(),addr3:$("#txtCoyAddr3").val(),addr4:$("#txtCoyAddr4").val(),addr5:$("#txtCoyAddr5").val()};var a="request.pzx?c="+coy_url+"&d="+new Date().getTime();callServer(a,"json",c,onCompanyResponse,coy_obj)}}function printCompany(){var a="report.pzx?c="+coy_url+"&d="+new Date().getTime();showReport(a)}function editCompany(d,c){var b={type:C_GET,id:d};var a="request.pzx?c="+coy_url+"&d="+new Date().getTime();coy_obj=c;callServer(a,"json",b,showCompany,c)}function deleteCompany(d,c){if(confirm("Confirm you want to delete company id : "+d+"?")){var b={type:C_DELETE,id:d};var a="request.pzx?c="+coy_url+"&d="+new Date().getTime();callServer(a,"json",b,onCompanyResponse,c)}}function showCompany(a,b){if(b.status==C_OK){$("#txtCoyId").val(b.data.id);$("#txtCoyAcctNo").val(b.data.acctno);$("#cobCoyBank").val(b.data.bank);$("#txtCoyName").val(b.data.name);$("#txtCoyRef").val(b.data.refno);$("#txtCoyTel").val(b.data.tel);$("#txtCoyFax").val(b.data.fax);$("#txtCoyAddr1").val(b.data.addr1);$("#txtCoyAddr2").val(b.data.addr2);$("#txtCoyAddr3").val(b.data.addr3);$("#txtCoyAddr4").val(b.data.addr4);$("#txtCoyAddr5").val(b.data.addr5);$("#txtCoyRegNo").val(b.data.regno);$("#cobCoyRegType").val(b.data.regtype);$("#txtCoyCpfNo").val(b.data.cpfno);$("#txtCoyCpfRef").val(b.data.cpfref);$("#txtCoyAuthName").val(b.data.authname);$("#txtCoyAuthTitle").val(b.data.authtitle);$("#txtCoyAuthTel").val(b.data.authtelno);$("#txtCoyEgm").val(b.data.egmdate);$("#txtCoyBonus").val(b.data.bonusdate);$("#btnCoyUpdate").prop("disabled","");$("#txtCoyCode").focus()}else{showDialog("System Message",b.mesg)}}function onCompanyResponse(a,b){if(b.status==C_OK){if(b.type==C_ADD){$("#sbg-company-table tr:first").after("<tr><td>"+b.data+"</td><td>"+$("#txtCoyName").val()+"</td><td style='text-align:center'><a href='javascript:' onclick='editCompany("+b.data+",this)'><img src='image/edit_16.png' title='Edit'></img></a></td><td style='text-align:center'><a href='javascript:' onclick='deleteCompany("+b.data+",this)'><img src='image/delete_16.png' title='Delete'></img></a></td></tr>")}else{if(b.type==C_DELETE){$($(a).closest("tr")).remove()}else{if(b.type==C_UPDATE){$($(a).closest("tr")).children("td:eq(1)").text($("#txtCoyName").val())}}}$("#sbg-popup-box").html(b.mesg);$("#sbg-popup-box").show();$("#sbg-popup-box").fadeOut(5000);clearCompany()}else{showDialog("Error",b.mesg)}}function validateCompany(){$("#coy_err_mesg").text("");if($("#txtCoyName").blank()){$("#coy_err_name").show();$("#txtCoyName").focus();$("#coy_err_mesg").text("company name can not be blank.");return false}else{$("#coy_err_name").hide()}if($("#txtCoyCpfNo").blank()){$("#coy_err_cpfno").show();$("#txtCoyCpfNo").focus();$("#coy_err_mesg").text("CPF CSN number can not be blank.");return false}else{$("#coy_err_cpfno").hide()}if($("#txtCoyCpfRef").blank()){$("#coy_err_cpfref").show();$("#txtCoyCpfRef").focus();$("#coy_err_mesg").text("CPF Ref code can not be blank.");return false}else{$("#coy_err_cpfref").hide()}if($("#txtCoyRegNo").blank()){$("#coy_err_regno").show();$("#txtCoyRegNo").focus();$("#coy_err_mesg").text("Registeration no can not be blank.");return false}else{$("#coy_err_regno").hide()}if($("#cobCoyRegType").blank()){$("#coy_err_regtype").show();$("#cobCoyRegType").focus();$("#coy_err_mesg").text("You must select a Registeration no type.");return false}else{$("#coy_err_regtype").hide()}if($("#txtCoyAuthName").blank()){$("#coy_err_authname").show();$("#txtCoyAuthName").focus();$("#coy_err_mesg").text("Authorised person name can not be blank.");return false}else{$("#coy_err_authname").hide()}return true};