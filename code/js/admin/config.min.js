var config_temp="";var config_type="";$(document).ready(function(){$("input").css("marginTop",0);$("input").css("marginBottom",0);$("select").css("marginTop",0);$("select").css("marginBottom",0);$("#config-tabs").tabs();$("#txtConfigServer").focus();$("#btnConfigSave").button().bind("click",saveConfig);$("#btnConfigTest").button().bind("click",testConfig);$("#btnConfigCreate").button().bind("click",createConfig);$("#txtConfigDbPort").keypress(function(){numericInput(0,"",0,0)})});function saveConfig(){config_type="u";if(config_temp==""){var b={type:"g"};var a="admin.pzx?&d="+new Date().getTime();callServer(a,"json",b,onConfigResponse,null)}else{if(validateConfig()){var b={type:"u",server:$("#txtConfigServer").val(),dbname:$("#txtConfigDbName").val(),dbuser:$("#txtConfigDbUser").val(),dbpwd:strToHex(xxtea_encrypt($("#txtConfigDbPwd").val(),config_temp)),dbport:$("#txtConfigPort").val(),dbtype:$("#cobConfigDbType").val()};var a="admin.pzx?d="+new Date().getTime();clearConfig();config_temp="";callServer(a,"json",b,onConfigResponse,null)}}}function testConfig(){config_type="q";if(config_temp==""){var b={type:"g"};var a="admin.pzx?&d="+new Date().getTime();callServer(a,"json",b,onConfigResponse,null)}else{if(validateConfig()){var b={type:"q",server:$("#txtConfigServer").val(),dbname:$("#txtConfigDbName").val(),dbuser:$("#txtConfigDbUser").val(),dbpwd:strToHex(xxtea_encrypt($("#txtConfigDbPwd").val(),config_temp)),dbport:$("#txtConfigPort").val(),dbtype:$("#cobConfigDbType").val()};var a="admin.pzx?d="+new Date().getTime();clearConfig();config_temp="";config_type="";callServer(a,"text",b,onConfigTestResponse,null)}}}function createConfig(){}function clearConfig(){$("#config_err_mesg").text("")}function onConfigResponse(a,b){if(b.status=="0"){if(b.type=="g"){config_temp=b.data;if(config_type=="q"){testConfig()}else{saveConfig()}}else{alert(b.mesg);clearConfig()}}else{alert(b.mesg)}}function onConfigTestResponse(a,b){alert(b)}function validateConfig(){$("#config_err_mesg").text("");if($("#txtConfigServer").blank()){$("#config_err_server").show();$("#txtConfigServer").focus();$("#config_err_mesg").text("Server name can not be blank.");return false}else{$("#config_err_server").hide()}if($("#txtConfigDbName").blank()){$("#config_err_name").show();$("#txtConfigDbName").focus();$("#config_err_mesg").text("Database name can not be blank.");return false}else{$("#config_err_name").hide()}if(!$("#txtConfigDbPort").blank()){if(!isInt($("#txtConfigDbPort").val())){$("#config_err_port").show();$("#txtConfigDbPort").focus();$("#config_err_mesg").text("Invalid Port no. Port no must be integer.");return false}else{$("#config_err_port").hide()}}else{$("#config_err_port").hide()}if($("#txtConfigDbUser").blank()){$("#config_err_user").show();$("#txtConfigDbUser").focus();$("#config_err_mesg").text("Database login user name can not be blank.");return false}else{$("#config_err_user").hide()}if($("#txtConfigDbPwd").blank()){$("#config_err_pwd").show();$("#txtConfigDbPwd").focus();$("#config_err_mesg").text("Database login password can not be blank.");return false}else{$("#config_err_pwd").hide()}return true}function isInt(a){var b=parseInt(a);if(isNaN(b)){return false}return a==b&&a.toString()==b.toString()};