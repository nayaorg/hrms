var user_obj=null;$(document).ready(function(){$("input").css("marginTop",0);$("input").css("marginBottom",0);$("select").css("marginTop",0);$("select").css("marginBottom",0);var a={dateFormat:"dd/mm/yy",appendText:"  dd/mm/yyyy",showOn:"button",buttonImage:"image/calendar.gif",buttonImageOnly:true};$("#txtUserStart").datepicker(a);$("#txtUserExpiry").datepicker(a);$("#btnUserClear").button().bind("click",clearUser);$("#btnUserUpdate").button().bind("click",updateUser);$("#btnUserAdd").button().bind("click",addUser);$("#btnUserPrint").button().bind("click",printUser);$("#user-tabs").tabs();$("#txtUserName").focus();$(window).resize(resizeUserGrid);resizeUserGrid();clearUser()});function resizeUserGrid(){var a=$("#sbg-center-panel").outerHeight()-$("#sbg-user-entry").outerHeight()-55;$("div#sbg-user-data").css("height",a+"px")}function clearUser(){$("#txtUserId").val("Auto");$("#txtUserName").val("");$("#txtUserFull").val("");$("#txtUserEmail").val("");$("#txtUserStart").val("");$("#txtUserExpiry").val("");$("#cobUserGroup").val("");$("#user-tabs").tabs("option","active",0);$("#txtUserName").focus();$("#btnUserUpdate").prop("disabled","disabled");$("#user_err_name").hide();$("#user_err_full").hide();$("#user_err_group").hide();$("#user_err_mesg").text("");user_obj=null}function updateUser(){saveUser(C_UPDATE)}function addUser(){saveUser(C_ADD)}function saveUser(b){if(validateUser()){var d="0";var c={type:b,id:$("#txtUserId").val(),name:$("#txtUserName").val(),email:$("#txtUserEmail").val(),start:$("#txtUserStart").val(),expiry:$("#txtUserExpiry").val(),block:d,fullname:$("#txtUserFull").val(),group:$("#cobUserGroup").val()};var a="request.pzx?c="+user_url+"&d="+new Date().getTime();callServer(a,"json",c,onUserResponse,user_obj)}}function printUser(){var a="report.pzx?c="+user_url+"&d="+new Date().getTime();showReport(a)}function editUser(d,c){var b={type:C_GET,id:d};var a="request.pzx?c="+user_url+"&d="+new Date().getTime();user_obj=c;callServer(a,"json",b,showUser,c)}function deleteUser(d,c){if(confirm("Confirm you want to delete user id : "+d+"?")){var b={type:C_DELETE,id:d};var a="request.pzx?c="+user_url+"&d="+new Date().getTime();callServer(a,"json",b,onUserResponse,c)}}function showUser(a,b){if(b.status==C_OK){$("#txtUserId").val(b.data.id);$("#txtUserName").val(b.data.name);$("#txtUserFull").val(b.data.fullname);$("#txtUserEmail").val(b.data.email);$("#txtUserStart").val(b.data.start);$("#txtUserExpiry").val(b.data.expiry);$("#cobUserGroup").val(b.data.group);$("#btnUserUpdate").prop("disabled","");$("#txtUserName").focus()}else{showDialog("System Message",b.mesg)}}function onUserResponse(a,b){if(b.status==C_OK){if(b.type==C_ADD){$("#sbg-user-table tr:first").after("<tr><td>"+b.data+"</td><td>"+$("#txtUserName").val()+"</td><td>"+$("#txtUserFull").val()+"</td><td>"+$("#cobUserGroup :selected").text()+"</td><td style='text-align:center'><a href='javascript:' onclick='editUser("+b.data+",this)'><img src='image/edit_16.png' title='Edit'></img></a></td><td style='text-align:center'><a href='javascript:' onclick='deleteUser("+b.data+",this)'><img src='image/delete_16.png' title='Delete'></img></a></td></tr>")}else{if(b.type==C_DELETE){$($(a).closest("tr")).remove()}else{if(b.type==C_UPDATE){$($(a).closest("tr")).children("td:eq(1)").text($("#txtUserName").val());$($(a).closest("tr")).children("td:eq(2)").text($("#txtUserFull").val());$($(a).closest("tr")).children("td:eq(3)").text($("#cobUserGroup :selected").text())}}}$("#sbg-popup-box").html(b.mesg);$("#sbg-popup-box").show();$("#sbg-popup-box").fadeOut(5000);clearUser()}else{showDialog("Error",b.mesg)}}function validateUser(){$("#user_err_mesg").text("");if($("#txtUserName").blank()){$("#user_err_name").show();$("#txtUserName").focus();$("#user_err_mesg").text("User signin name can not be blank.");return false}else{$("#user_err_name").hide()}if($("#txtUserFull").blank()){$("#user_err_full").show();$("#txtUserFull").focus();$("#user_err_mesg").text("You must enter the name of this user.");return false}else{$("#user_err_full").hide()}if($("#cobUserGroup").val()==""){$("#user_err_group").show();$("#cobUserGroup").focus();$("#user_err_mesg").text("You must assign a User group to this user");return false}else{$("#user_err_group").hide()}return true};