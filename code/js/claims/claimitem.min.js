var claim_item_obj=null;$(document).ready(function(){$("#btnClaimItemClear").button().bind("click",clearClaimItem);$("#btnClaimItemUpdate").button().bind("click",updateClaimItem);$("#btnClaimItemAdd").button().bind("click",addClaimItem);$("#btnClaimItemUpdate").hide();$(window).resize(resizeClaimItemGrid);resizeClaimItemGrid()});function resizeClaimItemGrid(){var a=$("#sbg-center-panel").outerHeight()-$("#claim-popup").outerHeight()-75;$("div#sbg-claim-item-data").css("height",a+"px")}function clearClaimItem(){getNewLineNo($("#txtClaimItemClaimId").val());$("#txtClaimItemDesc").val("");$("#cobExpenseItem").val("");$("#txtClaimItemAmount").val("");$("#txtClaimItemCurrency").val("SGD");$("#txtClaimItemDocumentId").val("");$("#claim_err_mesg").text("");$("#claim_err_desc").hide();$("#claim_err_expense_item").hide();$("#claim_err_amount").hide();$("#btnClaimItemUpdate").hide();$("#btnClaimItemAdd").show();claim_item_obj=null}function updateClaimItem(){saveClaimItem(C_UPDATE)}function addClaimItem(){saveClaimItem(C_ADD)}function saveClaimItem(b){if(validateClaimItem()){var c={type:b,id:$("#txtClaimItemClaimId").val(),line_no:$("#txtClaimItemLineNo").val(),desc:$("#txtClaimItemDesc").val(),expense_item:$("#cobExpenseItem").val(),amt:$("#txtClaimItemAmount").val(),curr:$("#txtClaimItemCurrency").val(),doc_id:$("#txtClaimItemDocumentId").val()};var a="request.pzx?c="+claim_item_url+"&d="+new Date().getTime();callServer(a,"json",c,onClaimItemResponse,claim_item_obj)}}function editClaimItem(e,a,d){var c={type:C_GET,id:e,line_no:a};var b="request.pzx?c="+claim_item_url+"&d="+new Date().getTime();claim_item_obj=d;callServer(b,"json",c,showClaimItem,d)}function deleteClaimItem(e,a,d){if(confirm("Confirm you want to delete claim item : id-"+e+", line no.-"+a+"?")){var c={type:C_DELETE,id:e,line_no:a};var b="request.pzx?c="+claim_item_url+"&d="+new Date().getTime();callServer(b,"json",c,onClaimItemResponse,d)}}function showClaimItem(a,b){if(b.status==C_OK){$("#txtClaimItemClaimId").val(b.data.id);$("#txtClaimItemLineNo").val(b.data.line_no);$("#txtClaimItemDesc").val(b.data.desc);$("#cobExpenseItem").val(b.data.expense_item);$("#txtClaimItemAmount").val(b.data.amt);$("#txtClaimItemCurrency").val(b.data.curr);$("#txtClaimItemDocumentId").val(b.data.doc_id);$("#txtClaimItemDesc").focus();$("#btnClaimItemUpdate").show();$("#btnClaimItemAdd").hide();$(".sbg-tab-title").html("Claim (ID: "+b.data.id+")")}else{showDialog("System Message",b.mesg)}}function showAllClaimItems(c){var b={type:C_LIST,id:c};var a="request.pzx?c="+claim_item_url+"&d="+new Date().getTime();$("#txtClaimItemClaimId").val(c);callServer(a,"json",b,onClaimItemResponse,claim_item_obj)}function onClaimItemResponse(a,b){if(b.status==C_OK){if(b.type==C_ADD){showAllClaimItems($("#txtClaimItemClaimId").val())}else{if(b.type==C_DELETE){$($(a).closest("tr")).remove()}else{if(b.type==C_UPDATE){showAllClaimItems($("#txtClaimItemClaimId").val());$("#btnClaimItemAdd").show();$("#btnClaimItemClear").show();$("#btnClaimItemUpdate").hide()}else{if(b.type==C_LIST){$("tr#claim-item-rows").remove();jQuery.each(b.data,function(){$("#sbg-claim-item-table tr:first").after("<tr id='claim-item-rows'><td>"+this.line_no+"</td><td>"+this.desc+"</td><td>"+this.expense_item+"</td><td>"+this.amt+"</td><td>"+this.curr+"</td><td>"+this.approved_amt+"</td><td>"+this.doc_id+"</td><td style='text-align:center'><a href='javascript:' onclick='editClaimItem("+this.id+","+this.line_no+",this)'><img src='image/edit_16.png' title='Edit'></img></a></td><td style='text-align:center'><a href='javascript:' onclick='deleteClaimItem("+this.id+","+this.line_no+",this)'><img src='image/delete_16.png' title='Delete'></img></a></td></tr>")})}}}}$("#sbg-popup-box").html(b.mesg);$("#sbg-popup-box").show();$("#sbg-popup-box").fadeOut(5000);clearClaimItem()}else{showDialog("Error",b.mesg)}}function validateClaimItem(){var a=true;$("#claim_item_err_mesg").text("");if($("#txtClaimItemDesc").blank()){$("#claim_item_err_desc").show();$("#txtClaimItemDesc").focus();$("#claim_item_err_mesg").text($("#claim_item_err_mesg").text()+"Description can not be blank. ");a=false}else{$("#claim_item_err_desc").hide()}if($("#cobExpenseItem").blank()){$("#claim_item_err_expense_item").show();$("#cobExpenseItem").focus();$("#claim_item_err_mesg").text($("#claim_item_err_mesg").text()+"Expense Item Group can not be blank. ");a=false}else{$("#claim_item_err_expense_item").hide()}if($("#txtClaimItemAmount").blank()){$("#claim_item_err_amount").show();$("#txtClaimItemAmount").focus();$("#claim_item_err_mesg").text($("#claim_item_err_mesg").text()+"Amount can not be blank. ");a=false}else{$("#claim_item_err_amount").hide()}return a}function getNewLineNo(c){var b={type:C_LIST,id:c};var a="request.pzx?c="+claim_item_url+"&d="+new Date().getTime();callServer(a,"json",b,function(e,f){var d=0;jQuery.each(f.data,function(){if(parseInt(this.line_no)>d){d=parseInt(this.line_no)}});d=d+100;$("#txtClaimItemLineNo").val(d)},claim_item_obj)};