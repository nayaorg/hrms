var travel_plan_obj=null;$(document).ready(function(){$("#btnTravelPlanAdd").button().bind("click",addTravelPlan);$("#btnTravelPlanClear").button().bind("click",clearTravelPlan);$("#btnTravelPlanUpdate").button().bind("click",updateTravelPlan);$("#btnTravelPlanPrint").button().bind("click",printTravelPlan);$("#btnTravelPlanUpdate").hide();var a={dateFormat:"dd/mm/yy",appendText:"  dd/mm/yyyy",showOn:"button",buttonImage:"image/calendar.gif",buttonImageOnly:true};$("#txtTravelDate").datepicker(a);$("#txtTravelExpiry").datepicker(a);$("#travel-plan-tabs").tabs();$("#txtTravelPlan").focus();clearTravelPlan();$(window).resize(resizeTravelPlanGrid);resizeTravelPlanGrid()});function resizeTravelPlanGrid(){var a=$("#sbg-center-panel").outerHeight()-$("#sbg-travel-plan-entry").outerHeight()-55;$("div#sbg-travel-plan-data").css("height",a+"px")}function clearTravelPlan(){$("#txtTravelPlanId").val("Auto");$("#txtTravelPlanTitle").val("");$("#txtTravelPlanDesc").val("");$("#cobTravelPlanCountry").val("");$("#txtTravelDate").val("");$("#txtTravelExpiry").val("");$("#travel-plan-tabs").tabs("option","active",0);$("#travel_plan_err_mesg").text("");$("#travel_plan_err_title").hide();$("#travel_plan_err_desc").hide();$("#btnTravelPlanUpdate").hide();$("#btnTravelPlanAdd").show();travel_plan_obj=null}function updateTravelPlan(){saveTravelPlan(C_UPDATE)}function addTravelPlan(){saveTravelPlan(C_ADD)}function saveTravelPlan(b){if(validateTravelPlan()){var c={type:b,id:$("#txtTravelPlanId").val(),title:$("#txtTravelPlanTitle").val(),desc:$("#txtTravelPlanDesc").val(),country:$("#cobTravelPlanCountry").val(),start:$("#txtTravelDate").val(),expiry:$("#txtTravelExpiry").val()};var a="request.pzx?c="+travel_plan_url+"&d="+new Date().getTime();callServer(a,"json",c,onTravelPlanResponse,travel_plan_obj)}}function editTravelPlan(d,c){var b={type:C_GET,id:d};var a="request.pzx?c="+travel_plan_url+"&d="+new Date().getTime();travel_plan_obj=c;callServer(a,"json",b,showTravelPlan,c)}function deleteTravelPlan(d,c){if(confirm("Confirm you want to delete travel plan id : "+d+"?")){var b={type:C_DELETE,id:d};var a="request.pzx?c="+travel_plan_url+"&d="+new Date().getTime();callServer(a,"json",b,onTravelPlanResponse,c)}}function showTravelPlan(a,b){if(b.status==C_OK){$("#txtTravelPlanId").val(b.data.id);$("#txtTravelPlanTitle").val(b.data.title);$("#txtTravelPlanDesc").val(b.data.desc);$("#cobTravelPlanCountry").val(b.data.country);$("#txtTravelDate").val(b.data.start);$("#txtTravelExpiry").val(b.data.expiry);$("#txtTravelPlanTitle").focus();$("#btnTravelPlanUpdate").show();$("#btnTravelPlanAdd").hide()}else{showDialog("System Message",b.mesg)}}function onTravelPlanResponse(a,b){if(b.status==C_OK){if(b.type==C_ADD){$("#sbg-travel-plan-table tr:first").after("<tr><td>"+b.data+"</td><td>"+$("#txtTravelPlanTitle").val()+"</td><td>"+$("#txtTravelPlanDesc").val()+"</td><td>"+$("#cobTravelPlanCountry :selected").text()+"</td><td style='text-align:center'><a href='javascript:' onclick='editTravelPlan("+b.data+",this)'><img src='image/edit_16.png' title='Edit'></img></a></td><td style='text-align:center'><a href='javascript:' onclick='deleteTravelPlan("+b.data+",this)'><img src='image/delete_16.png' title='Delete'></img></a></td></tr>")}else{if(b.type==C_DELETE){$($(a).closest("tr")).remove()}else{if(b.type==C_UPDATE){$($(a).closest("tr")).children("td:eq(0)").html($("#txtTravelPlanId").val());$($(a).closest("tr")).children("td:eq(1)").html($("#txtTravelPlanTitle").val());$($(a).closest("tr")).children("td:eq(2)").text($("#txtTravelPlanDesc").val());$($(a).closest("tr")).children("td:eq(3)").text($("#cobTravelPlanCountry :selected").text())}}}$("#sbg-popup-box").html(b.mesg);$("#sbg-popup-box").show();$("#sbg-popup-box").fadeOut(5000);clearTravelPlan()}else{showDialog("Error",b.mesg)}}function validateTravelPlan(){$("#travel_plan_err_mesg").text("");if($("#txtTravelPlanTitle").blank()){$("#travel_plan_err_title").show();$("#txtTravelPlanTitle").focus();$("#travel_plan_err_mesg").text($("#travel_plan_err_mesg").text()+"Title can not be blank.");return false}else{$("#travel_plan_err_title").hide()}if($("#txtTravelPlanDesc").blank()){$("#travel_plan_err_desc").show();$("#txtTravelPlanDesc").focus();$("#travel_plan_err_mesg").text($("#travel_plan_err_mesg").text()+"Description can not be blank.");return false}else{$("#travel_plan_err_desc").hide()}return true}function printTravelPlan(){var a="report.pzx?c="+travel_plan_url+"&d="+new Date().getTime();showReport(a)};