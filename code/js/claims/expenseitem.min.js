var expense_item_obj=null;var m_limitidx=0;$(document).ready(function(){$("#btnExpenseItemAdd").button().bind("click",addExpenseItem);$("#btnExpenseItemClear").button().bind("click",clearExpenseItem);$("#btnExpenseItemUpdate").button().bind("click",updateExpenseItem);$("#btnExpenseItemPrint").button().bind("click",printExpenseItem);$("#btnExpenseItemUpdate").hide();$("#expense-item-tabs").tabs();$("#txtExpenseItemDesc").focus();clearExpenseItem();$(window).resize(resizeExpenseItemGrid);resizeExpenseItemGrid()});function resizeExpenseItemGrid(){var a=$("#sbg-center-panel").outerHeight()-$("#sbg-expense-item-entry").outerHeight()-55;$("div#sbg-expense-item-data").css("height",a+"px")}function clearExpenseItem(){$("#txtExpenseItemId").val("Auto");$("#txtExpenseItemRef").val("");$("#cobExpenseItemGroup").val("");$("#txtExpenseItemDesc").val("");$("#tblLimit").empty();$("#expense-item-tabs").tabs("option","active",0);$("#expense_item_err_mesg").text("");$("#expense_item_err_name").hide();$("#expense_item_err_group").hide();$("#expense_item_err_desc").hide();$("#btnExpenseItemUpdate").hide();$("#btnExpenseItemAdd").show();if(expense_item_obj!=null&&expense_item_obj!=undefined){$($(expense_item_obj).closest("tr")).removeClass("sbg-row-selected")}m_limitidx=0;expense_item_obj=null}function updateExpenseItem(){saveExpenseItem(C_UPDATE)}function addExpenseItem(){saveExpenseItem(C_ADD)}function saveExpenseItem(b){if(validateExpenseItem()){var c={type:b,id:$("#txtExpenseItemId").val(),ref:$("#txtExpenseItemRef").val(),group:$("#cobExpenseItemGroup").val(),desc:$("#txtExpenseItemDesc").val(),limits:getClaimLimit()};var a="request.pzx?c="+expense_item_url+"&d="+new Date().getTime();callServer(a,"json",c,onExpenseItemResponse,expense_item_obj)}}function editExpenseItem(d,c){var b={type:C_GET,id:d};var a="request.pzx?c="+expense_item_url+"&d="+new Date().getTime();clearExpenseItem();expense_item_obj=c;$($(c).closest("tr")).addClass("sbg-row-selected");callServer(a,"json",b,showExpenseItem,c)}function deleteExpenseItem(d,c){if(confirm("Confirm you want to delete expense item id : "+d+"?")){var b={type:C_DELETE,id:d};var a="request.pzx?c="+expense_item_url+"&d="+new Date().getTime();callServer(a,"json",b,onExpenseItemResponse,c)}}function showExpenseItem(a,b){if(b.status==C_OK){$("#txtExpenseItemId").val(b.data.id);$("#txtExpenseItemRef").val(b.data.ref);$("#cobExpenseItemGroup").val(b.data.group);$("#txtExpenseItemDesc").val(b.data.desc);if(b.data.limits!=""){setClaimLimit(b.data.limits)}$("#txtExpenseItemDesc").focus();$("#btnExpenseItemUpdate").show();$("#btnExpenseItemAdd").hide()}else{showDialog("System Message",b.mesg)}}function onExpenseItemResponse(a,b){if(b.status==C_OK){if(b.type==C_ADD){$("#sbg-expense-item-table tr:first").after("<tr><td>"+b.data.id+"</td><td>"+$("#txtExpenseItemDesc").val()+"</td><td>"+$("#cobExpenseItemGroup :selected").text()+"</td><td>"+$("#txtExpenseItemRef").val()+"</td><td style='text-align:center'><a href='javascript:' onclick='editExpenseItem("+b.data+",this)'><img src='image/edit_16.png' title='Edit'></img></a></td><td style='text-align:center'><a href='javascript:' onclick='deleteExpenseItem("+b.data+",this)'><img src='image/delete_16.png' title='Delete'></img></a></td></tr>")}else{if(b.type==C_DELETE){$($(a).closest("tr")).remove()}else{if(b.type==C_UPDATE){$($(a).closest("tr")).children("td:eq(0)").html($("#txtExpenseItemId").val());$($(a).closest("tr")).children("td:eq(1)").html($("#txtExpenseItemDesc").val());$($(a).closest("tr")).children("td:eq(2)").text($("#cobExpenseItemGroup :selected").text());$($(a).closest("tr")).children("td:eq(3)").text($("#txtExpenseItemRef").val())}}}$("#sbg-popup-box").html(b.mesg);$("#sbg-popup-box").show();$("#sbg-popup-box").fadeOut(5000);clearExpenseItem()}else{showDialog("Error",b.mesg)}}function validateExpenseItem(){$("#expense_item_err_mesg").text("");if($("#txtExpenseItemDesc").blank()){$("#expense_item_err_desc").show();$("#txtExpenseItemDesc").focus();$("#expense_item_err_mesg").text($("#expense_item_err_mesg").text()+"Expense Item description can not be blank. ");return false}else{$("#expense_item_err_desc").hide()}if($("#cobExpenseItemGroup").blank()){$("#expense_item_err_group").show();$("#cobExpenseItemGroup").focus();$("#expense_item_err_mesg").text($("#expense_item_err_mesg").text()+"Please select an Expense Item Group. ");return false}else{$("#expense_item_err_group").hide()}return true}function printExpenseItem(){var a="report.pzx?c="+expense_item_url+"&d="+new Date().getTime();showReport(a)}function addClaimLimit(){m_limitidx++;$("#tblLimit").append("<tr id='tritem"+m_limitidx+"'><td style='width:30px;'>"+m_limitidx+"</td><td style='width:200px;'><select style='width:200px' id='cobExpenseClaimGroup"+m_limitidx+"'></select></td><td style='width:120px;'><select style='width:120px' id='cobExpenseClaimType"+m_limitidx+"'></select></td><td style='width:80px;'><input type='text' maxlength='8' size='8' onkeypress=numericInput(2,'.',0,2) id='txtExpenseLimitAmt"+m_limitidx+"'></input></td><td style='width:40px;text-align:center;'><a href='javascript:' onclick='removeClaimLimit("+m_limitidx+")'><img src='image/remove_16.png' title='Remove'></img></a></td></tr>");$("#cobExpenseClaimGroup"+m_limitidx).append($("#cobExpenseClaimGroup").html());$("#cobExpenseClaimType"+m_limitidx).append($("#cobExpenseClaimType").html())}function removeClaimLimit(a){$("#tritem"+a).remove()}function setClaimLimit(b){if(b==undefined||b==null||b==""){return}var a=b.split("|");var d="";m_limitidx=0;for(var c=0;c<a.length;c++){if(a[c]!=""){d=a[c].split(":");m_limitidx++;$("#tblLimit").append("<tr id='tritem"+m_limitidx+"'><td style='width:30px;'>"+m_limitidx+"</td><td style='width:200px;'><select style='width:200px' id='cobExpenseClaimGroup"+m_limitidx+"'></select></td><td style='width:120px;'><select style='width:120px' id='cobExpenseClaimType"+m_limitidx+"'></select></td><td style='width:80px;'><input type='text' maxlength='8' size='8' onkeypress=numericInput(2,'.',0,2) id='txtExpenseLimitAmt"+m_limitidx+"'></input></td><td style='width:40px;text-align:center;'><a href='javascript:' onclick='removeClaimLimit("+m_limitidx+")'><img src='image/remove_16.png' title='Remove'></img></a></td></tr>");$("#cobExpenseClaimGroup"+m_limitidx).append($("#cobExpenseClaimGroup").html());$("#cobExpenseClaimGroup"+m_limitidx).val(d[0]);$("#cobExpenseClaimType"+m_limitidx).append($("#cobExpenseClaimType").html());$("#cobExpenseClaimType"+m_limitidx).val(d[1]);$("#txtExpenseLimitAmt"+m_limitidx).val(d[2])}}}function getClaimLimit(){var b="";var c="";var f="";var a="";var d="";var e="";$("#tblLimit tr").each(function(){f=$(this).find("td").eq(0).html();a=$("#cobExpenseClaimGroup"+f).val();d=$("#cobExpenseClaimType"+f).val();e=$("#txtExpenseLimitAmt"+f).val();if(a==undefined||a==null||a==""){}else{b=b+c+a+":"+d+":"+e;c="|"}});return b};