var claim_doc_obj=null;var check_for_empty_file=true;var upload_form=null;$(document).ready(function(){$("#btnClaimDocClear").button().bind("click",clearClaimDoc);$("#btnClaimDocUpdate").button().bind("click",updateClaimDoc);$("#btnClaimDocAdd").button().bind("click",addClaimDoc);$("#fileClaimDoc").change(setUploadForm);$("#btnClaimDocUpdate").hide();showAllClaimDocuments($("#txtClaimDocClaimId").val());$(window).resize(resizeClaimDocGrid);resizeClaimDocGrid()});function resizeClaimDocGrid(){var a=$("#sbg-center-panel").outerHeight()-$("#claim-popup").outerHeight()-75;$("div#sbg-claim-doc-data").css("height",a+"px")}function clearClaimDoc(){$("#txtClaimDocId").val("Auto");$("#txtClaimDocRef").val("");$("#txtClaimDocDesc").val("");$("#fileClaimDoc").val("");$("#txtClaimDocPath").val("");$("#claim_doc_err_mesg").text("");$("#claim_doc_err_ref").hide();$("#claim_doc_err_desc").hide();$("#btnClaimDocUpdate").hide();$("#btnClaimDocAdd").show();claim_doc_obj=null;check_for_empty_file=true;upload_form=null}function setUploadForm(){upload_form=this.form}function updateClaimDoc(){saveClaimDoc(C_UPDATE)}function addClaimDoc(){if(validateClaimDoc()){uploadClaimDocument()}}function saveClaimDoc(b){var c={type:b,id:$("#txtClaimDocId").val(),claim_id:$("#txtClaimDocClaimId").val(),ref:$("#txtClaimDocRef").val(),desc:$("#txtClaimDocDesc").val(),path:$("#txtClaimDocPath").val()};var a="request.pzx?c="+claim_doc_url+"&d="+new Date().getTime();callServer(a,"json",c,onClaimDocResponse,claim_doc_obj)}function editClaimDoc(d,c){var b={type:C_GET,id:d};var a="request.pzx?c="+claim_doc_url+"&d="+new Date().getTime();claim_doc_obj=c;callServer(a,"json",b,showClaimDoc,c)}function deleteClaimDoc(d,c){if(confirm("Confirm you want to delete claim document id: "+d+" ?")){var b={type:C_DELETE,id:d};var a="request.pzx?c="+claim_doc_url+"&d="+new Date().getTime();callServer(a,"json",b,onClaimDocResponse,c)}}function showClaimDoc(a,b){if(b.status==C_OK){$("#txtClaimDocId").val(b.data.id);$("#txtClaimDocClaimId").val(b.data.claim_id);$("#txtClaimDocRef").val(b.data.ref);$("#txtClaimDocDesc").val(b.data.desc);$("#txtClaimDocPath").val(b.data.path);$("#txtClaimDocRef").focus();$("#btnClaimDocUpdate").show();$("#btnClaimDocAdd").hide();check_for_empty_file=false}else{showDialog("System Message",b.mesg)}}function showAllClaimDocuments(c){var b={type:C_LIST,claim_id:c};var a="request.pzx?c="+claim_doc_url+"&d="+new Date().getTime();$("#txtClaimDocClaimId").val(c);callServer(a,"json",b,onClaimDocResponse,claim_doc_obj)}function onClaimDocResponse(c,d){if(d.status==C_OK){if(d.type==C_ADD){var a=$("#fileClaimDoc").val();var b=a.slice(a.indexOf(".")).toLowerCase();$("#txtClaimDocPath").val("claims/"+$("#txtClaimDocClaimId").val()+"/claim_doc_"+d.data+"_"+$("#txtClaimDocClaimId").val()+b);$("#sbg-claim-doc-table tr:first").after("<tr id='claim-doc-rows'><td>"+d.data+"</td><td>"+$("#txtClaimDocRef").val()+"</td><td>"+$("#txtClaimDocDesc").val()+"</td><td>"+$("#txtClaimDocPath").val()+"</td><td style='text-align:center'><a href='javascript:' onclick='editClaimDoc("+d.data+",this)'><img src='image/edit_16.png' title='Edit'></img></a></td><td style='text-align:center'><a href='javascript:' onclick='deleteClaimDoc("+d.data+",this)'><img src='image/delete_16.png' title='Delete'></img></a></td></tr>")}else{if(d.type==C_DELETE){$($(c).closest("tr")).remove()}else{if(d.type==C_UPDATE){$($(c).closest("tr")).children("td:eq(0)").html($("#txtClaimDocId").val());$($(c).closest("tr")).children("td:eq(1)").html($("#txtClaimDocRef").val());$($(c).closest("tr")).children("td:eq(2)").html($("#txtClaimDocDesc").val());$($(c).closest("tr")).children("td:eq(3)").html($("#txtClaimDocPath").val())}else{if(d.type==C_LIST){$("tr#claim-doc-rows").remove();jQuery.each(d.data,function(){$("#sbg-claim-doc-table tr:first").after("<tr id='claim-doc-rows'><td>"+this.id+"</td><td>"+this.ref+"</td><td>"+this.desc+"</td><td>"+this.path+"</td><td style='text-align:center'><a href='javascript:' onclick='editClaimDoc("+this.id+",this)'><img src='image/edit_16.png' title='Edit'></img></a></td><td style='text-align:center'><a href='javascript:' onclick='deleteClaimDoc("+this.id+",this)'><img src='image/delete_16.png' title='Delete'></img></a></td></tr>")})}}}}$("#sbg-popup-box").html(d.mesg);$("#sbg-popup-box").show();$("#sbg-popup-box").fadeOut(5000);clearClaimDoc()}else{showDialog("Error",d.mesg)}}function validateClaimDoc(){var a=true;$("#claim_doc_err_mesg").text("");if($("#txtClaimDocDesc").blank()){$("#claim_doc_err_desc").show();$("#txtClaimDocDesc").focus();$("#claim_doc_err_mesg").text($("#claim_doc_err_mesg").text()+"Description can not be blank. ");a=false}else{$("#claim_doc_err_desc").hide()}if($("#txtClaimDocRef").blank()){$("#claim_doc_err_ref").show();$("#txtClaimDocRef").focus();$("#claim_doc_err_mesg").text($("#claim_doc_err_mesg").text()+"Reference Number/Code can not be blank. ");a=false}else{$("#claim_doc_err_ref").hide()}if($("#fileClaimDoc").blank()&&check_for_empty_file==true){$("#claim_doc_err_file").show();$("#claim_doc_err_mesg").text($("#claim_doc_err_mesg").text()+"Please upload an image of the supporting document. ");a=false}else{$("#claim_doc_err_file").hide()}return a}function uploadClaimDocument(){var b=$("#fileClaimDoc").val();if(validDocExt(b)){var a="upload.pzx?t=c&n=fileClaimDoc&d="+new Date().getTime()+"&i="+$("#txtClaimDocClaimId").val();$("#claim_doc_upload").show();ajaxUpload(upload_form,a,onClaimDocUploadEnd)}}function validDocExt(a){var c=new Array(".png",".jpg",".jpeg",".doc",".docx",".pdf");var d=false;if(!a){return}while(a.indexOf("\\")!=-1){a=a.slice(a.indexOf("\\")+1)}var b=a.slice(a.indexOf(".")).toLowerCase();for(var e=0;e<c.length;e++){if(c[e]==b){d=true;break}}if(d){return true}else{showDialog("System Message","You can only upload files in .png, .jpg, .jpeg, .doc, .docx, .pdf format");$("#fileClaimDoc").val("");return false}}function onClaimDocUploadEnd(b){$("#claim_doc_upload").hide();var a=b.split("|");if(a[0]==C_OK){$("#txtClaimDocPath").val(a[1]);saveClaimDoc(C_ADD)}else{alert(a[1])}};