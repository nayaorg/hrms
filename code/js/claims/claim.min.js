var claim_obj=null;$(document).ready(function(){$("#btnClaimClear").button().bind("click",clearClaim);$("#btnClaimUpdate").button().bind("click",updateClaim);$("#btnClaimAdd").button().bind("click",addClaim);$("#btnClaimPrint").button().bind("click",printClaim);$("#btnClaimFilter").button().bind("click",showAllClaims);$("#claim-filter-by").change(populateFilterOptions);$("#txtClaimDesc").focus();$("#btnClaimUpdate").hide();$("#claim-tabs").tabs();$("#claim-popup-tabs").tabs();showAllClaims();$(window).resize(resizeClaimGrid);resizeClaimGrid();$(window).resize(resizeClaimPopupGrid);resizeClaimPopupGrid();clearClaim()});function resizeClaimGrid(){var a=$("#sbg-center-panel").outerHeight()-$("#sbg-claim-entry").outerHeight()-85;$("div#sbg-claim-data").css("height",a+"px")}function resizeClaimPopupGrid(){var a=$("#sbg-center-panel").outerHeight();$("div#claim-popup").css("height",a+"px")}function hidePopup(a){if(a==true){$("#claim-popup").animate({opacity:0,left:"+=150"},450,function(){$("#claim-popup").hide();showAllClaims()})}else{$("#claim-popup").show();$("#claim-popup").animate({opacity:1,left:"-=150"},450,function(){})}}function clearClaim(){$("#txtClaimId").val("Auto");$("#txtClaimDesc").val("");$("#cobClaimType").val("");$("#claim-tabs").tabs("option","active",0);$("#claim_err_mesg").text("");$("#claim_err_desc").hide();$("#claim_err_type").hide();$("#claim_err_date").hide();$("#claim_err_claim_by").hide();var a=dateTime();$("#txtClaimDate").val(a);$("#claim-popup").hide();$("#btnClaimAdd").show();$("#btnClaimUpdate").hide();$(".sbg-tab-title").html("Claim");claim_obj=null}function dateTime(){var c=new Date();var e=""+c.getMonth();if(e<10){e="0"+e}var b=""+c.getDate();if(b<10){b="0"+b}var a=""+c.getHours();if(a<10){a="0"+a}var d=""+c.getMinutes();if(d<10){d="0"+d}var f=""+c.getSeconds();if(f<10){f="0"+f}return str_date=c.getFullYear()+"-"+e+"-"+b}function updateClaim(){saveClaim(C_UPDATE)}function addClaim(){saveClaim(C_ADD)}function saveClaim(b){if(validateClaim()){var c={type:b,id:$("#txtClaimId").val(),desc:$("#txtClaimDesc").val(),claim_type:$("#cobClaimType").val(),date:$("#txtClaimDate").val(),amount:$("#txtClaimAmount").val(),claim_by:$("#txtClaimBy").val(),status:$("#txtClaimStatus").val(),approved_amount:$("#txtClaimApprovedAmount").val(),travel_plan:$("#cobTravelPlan").val()};var a="request.pzx?c="+claim_url+"&d="+new Date().getTime();callServer(a,"json",c,onClaimResponse,claim_obj)}}function editClaim(d,c){var b={type:C_GET,id:d};var a="request.pzx?c="+claim_url+"&d="+new Date().getTime();claim_obj=c;callServer(a,"json",b,showClaim,c)}function deleteClaim(d,c){if(confirm("Confirm you want to delete claim id : "+d+"?")){var b={type:C_DELETE,id:d};var a="request.pzx?c="+claim_url+"&d="+new Date().getTime();callServer(a,"json",b,onClaimResponse,c)}}function viewClaim(a){hidePopup(false);showAllClaimItems(a);showAllClaimDocuments(a);$("#claim-item-title").html("Claim (ID: "+a+")")}function showClaim(a,b){if(b.status==C_OK){$("#txtClaimId").val(b.data.id);$("#txtClaimDesc").val(b.data.desc);$("#cobClaimType").val(b.data.type);$("#txtClaimDate").val(b.data.date);$("#txtClaimAmount").val(b.data.amount);$("#txtClaimBy").val(b.data.claim_by);$("#txtClaimStatus").val(b.data.status);$("#txtClaimApprovedAmount").val(b.data.approved_amount);$("#cobTravelPlan").val(b.data.travel_plan);$("#txtClaimDesc").focus();$("#btnClaimUpdate").show();$("#btnClaimAdd").hide()}else{showDialog("System Message",b.mesg)}}function onClaimResponse(b,c){if(c.status==C_OK){if(c.type==C_ADD){$("#sbg-claim-table tr:first").after("<tr id='claim-rows'><td>"+c.data+"</td><td>"+$("#txtClaimDesc").val()+"</td><td>"+$("#cobClaimType").val()+"</td><td>"+$("#txtClaimDate").val()+"</td><td>"+$("#txtClaimAmount").val()+"</td><td>"+$("#txtClaimBy").val()+"</td><td>"+$("#txtClaimStatus").val()+"</td><td>"+$("#txtClaimApprovedAmount").val()+"</td><td>"+$("#cobTravelPlan option:selected").text()+"</td><td style='text-align:center'><a href='javascript:' onclick='viewClaim("+c.data+")'>View</a></td><td style='text-align:center'><a href='javascript:' onclick='editClaim("+c.data+",this)'><img src='image/edit_16.png' title='Edit'></img></a></td><td style='text-align:center'><a href='javascript:' onclick='deleteClaim("+c.data+",this)'><img src='image/delete_16.png' title='Delete'></img></a></td></tr>")}else{if(c.type==C_DELETE){$($(b).closest("tr")).remove()}else{if(c.type==C_UPDATE){$($(b).closest("tr")).children("td:eq(1)").html($("#txtClaimDesc").val());$($(b).closest("tr")).children("td:eq(2)").text($("#cobClaimType").val());var a=$("#txtClaimDate").val().split(" ");$($(b).closest("tr")).children("td:eq(3)").text(a[0]);$($(b).closest("tr")).children("td:eq(5)").text($("#txtClaimBy").val());$($(b).closest("tr")).children("td:eq(8)").text($("#cobTravelPlan").val());$("#btnClaimAdd").show();$("#btnClaimUpdate").hide()}else{if(c.type==C_LIST){$("tr#claim-rows").remove();jQuery.each(c.data,function(){var d=this.date.split(" ");$("#sbg-claim-table tr:first").after("<tr id='claim-rows'><td>"+this.id+"</td><td>"+this.desc+"</td><td>"+this.type+"</td><td>"+d[0]+"</td><td>"+this.amount+"</td><td>"+this.claim_by+"</td><td>"+this.status+"</td><td>"+this.approved_amount+"</td><td>"+this.travel_plan_title+"</td><td style='text-align:center'><a href='javascript:' onclick='viewClaim("+this.id+")'>View</a></td><td style='text-align:center'><a href='javascript:' onclick='editClaim("+this.id+",this)'><img src='image/edit_16.png' title='Edit'></img></a></td><td style='text-align:center'><a href='javascript:' onclick='deleteClaim("+this.id+",this)'><img src='image/delete_16.png' title='Delete'></img></a></td></tr>")})}}}}$("#sbg-popup-box").html(c.mesg);$("#sbg-popup-box").show();$("#sbg-popup-box").fadeOut(5000);clearClaim()}else{showDialog("Error",c.mesg)}}function validateClaim(){var a=true;$("#claim_err_mesg").text("");if($("#txtClaimDesc").blank()){$("#claim_err_desc").show();$("#txtClaimDesc").focus();$("#claim_err_mesg").text($("#claim_err_mesg").text()+"Claim description can not be blank. ");a=false}else{$("#claim_err_desc").hide()}if($("#cobClaimType").blank()){$("#claim_err_type").show();$("#cobClaimType").focus();$("#claim_err_mesg").text($("#claim_err_mesg").text()+"Please select a claim type. ");a=false}else{$("#claim_err_type").hide()}if($("#txtClaimDate").blank()){$("#claim_err_date").show();$("#txtClaimDate").focus();$("#claim_err_mesg").text($("#claim_err_mesg").text()+"Please enter a date. ");a=false}else{$("#claim_err_date").hide()}return a}function showAllClaims(){var b;if($("#claim-filter-by").val()!=""||$("#claim-filter-option").val()!=""){b={type:C_LIST,filter_conditions:$("#claim-filter-by").val()+" = '"+$("#claim-filter-option").val()+"'"}}else{b={type:C_LIST}}var a="request.pzx?c="+claim_url+"&d="+new Date().getTime();callServer(a,"json",b,onClaimResponse,claim_obj)}function printClaim(){var a="report.pzx?c="+claim_url+"&d="+new Date().getTime();showReport(a)}function populateFilterOptions(){if($("#claim-filter-by").val()=="CLAIM_STATUS"){$("#claim-filter-option").html("<option value='Approved'>Approved</option><option value='Pending Approval'>Pending</option>")}else{if($("#claim-filter-by").val()=="CLAIM_TYPE"){$("#claim-filter-option").html("<option value='Personal'>Personal</option><option value='Business'>Business</option>")}else{$("#claim-filter-option").html("<option value=''>-</option>")}}};