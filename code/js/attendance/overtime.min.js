var overtime_obj=null;var updateProcess=false;var dteopt={dateFormat:"dd/mm/yy",appendText:"  dd/mm/yyyy",showOn:"button",buttonImage:"image/calendar.gif",buttonImageOnly:true};$("#txtDateOver").datepicker(dteopt);var dteperiod={dateFormat:"dd/mm/yy",showOn:"button",buttonImage:"image/calendar.gif",buttonImageOnly:true};var dteperiod2={dateFormat:"dd/mm/yy",appendText:"  dd/mm/yyyy",showOn:"button",buttonImage:"image/calendar.gif",buttonImageOnly:true};$("#txtPeriodStart").datepicker(dteperiod);$("#txtPeriodEnd").datepicker(dteperiod2);$("#cobDept").change(populateEmployee);$("#btnOverTimeAdd").button().bind("click",addOverTime);$("#btnOverTimeClear").button().bind("click",clearOverTime);$("#btnOverTimeUpdate").button().bind("click",updateOverTime);$("#btnOverTimePrint").button().bind("click",printOverTime);$("#btnOvertimeApply").button().bind("click",getList);$("#btnOvertimeInputControl").button().bind("click",showInput);$("#btnOverTimeHide").button().bind("click",hideInput);$("#overtime-tabs").tabs();$("#txtOverTimeDesc").focus();$(window).resize(resizeOverTimeGrid);resizeOverTimeGrid();var TimeStart=document.getElementById("cboTimeStartHour");var TimeEnd=document.getElementById("cboTimeEndHour");for(var i=0;i<=23;++i){var option=document.createElement("option");var option2=document.createElement("option");var StrOp="";if(i<10){StrOp="0"}StrOp+=""+i;option.text=option.value=StrOp;option2.text=option2.value=StrOp;TimeStart.add(option,0);TimeEnd.add(option2,0)}var TimeStart=document.getElementById("cboTimeStartMinute");var TimeEnd=document.getElementById("cboTimeEndMinute");for(var i=0;i<=59;++i){var option=document.createElement("option");var option2=document.createElement("option");var StrOp="";if(i<10){StrOp="0"}StrOp+=""+i;option.text=option.value=StrOp;option2.text=option2.value=StrOp;TimeStart.add(option,0);TimeEnd.add(option2,0)}clearOverTime();getList();$("#sbg-overtime-entry").hide();function hideInput(){$("#sbg-overtime-entry").hide("slow")}function showInput(){$("#sbg-overtime-entry").show("slow")}function resizeOverTimeGrid(){var a=$("#sbg-center-panel").outerHeight()-$("#sbg-overtime-entry").outerHeight()-55;$("div#sbg-overtime-data").css("height",a+"px")}function clearOverTime(){$("#cobDept").val("");populateEmployee();$("#txtOverTimeDesc").val("");$("#cboTimeStartHour").val("00");$("#cboTimeStartMinute").val("00");$("#cboTimeEndHour").val("00");$("#cboTimeEndMinute").val("00");$("#overtimeId").val("-1");$("#cobProject").val("");var b=new Date();var a=b.getDate();var c=b.getMonth()+1;var d=b.getFullYear();if(a<10){a="0"+a}if(c<10){c="0"+c}$("#txtDateOver").val(a+"/"+c+"/"+d);$("#overtime-tabs").tabs("option","active",0);$("#cobEmpId").focus();$("#btnOverTimeUpdate").prop("disabled","disabled");$("#overtime_err_mesg").text("");$("#overtime_err_desc").hide();$("#cobEmpId").val("");$("#cobDept").prop("disabled","");$("#cobEmpId").prop("disabled","");overtime_obj=null}function recalculateTime(){var c=new Date(2000,0,1,parseInt($("#cboTimeStartHour").val()),parseInt($("#cboTimeStartMinute").val()));var a=new Date(2000,0,1,parseInt($("#cboTimeEndHour").val()),parseInt($("#cboTimeEndMinute").val()));var e=0;var b=a-c;var d=Math.floor(b/1000/60);e=e+(d>0?d:0);$("#txtOTHour").val(e)}function updateOverTime(){saveOverTime(C_UPDATE)}function addOverTime(){saveOverTime(C_ADD)}function saveOverTime(b){if(validateOverTime()){var c={type:b,desc:$("#txtOverTimeDesc").val(),project_id:$("#cobProject").val(),overtime_id:$("#overtimeId").val(),time_start:$("#cboTimeStartHour").val()+":"+$("#cboTimeStartMinute").val(),time_end:$("#cboTimeEndHour").val()+":"+$("#cboTimeEndMinute").val(),emp_id:$("#cobEmpId").val(),date_over:$("#txtDateOver").val(),ot_hour:$("#txtOTHour").val(),late_in:$("#inpLateIn").val(),early_out:$("#inpEarlyOut").val()};var a="request.pzx?c="+overtime_url+"&d="+new Date().getTime();callServer(a,"json",c,onOverTimeResponse,overtime_obj)}}function printOverTime(){var a="report.pzx?c="+overtime_url+"&d="+new Date().getTime()+"&dt="+$("#txtPeriodStart").val()+"&dtend="+$("#txtPeriodEnd").val();showReport(a)}function editOverTime(f,b,c,e){$("#cobDept").val("");populateEmployee();var d={type:C_GET,id:f,date:b,overtimeId:c};var a="request.pzx?c="+overtime_url+"&d="+new Date().getTime();overtime_obj=e;callServer(a,"json",d,showOverTime,e)}function deleteOverTime(f,b,c,e){if(confirm("Confirm you want to delete over time id : "+f+"?")){var d={type:C_DELETE,id:f,date:b,overtimeId:c};var a="request.pzx?c="+overtime_url+"&d="+new Date().getTime();callServer(a,"json",d,onOverTimeResponse,e)}}function showOverTime(a,b){if(b.status==C_OK){showInput();$("#txtOverTimeDesc").val(b.data.desc);$("#cboTimeStartHour").val(b.data.time_start.substr(0,2));$("#cboTimeStartMinute").val(b.data.time_start.substr(3,2));$("#cboTimeEndHour").val(b.data.time_end.substr(0,2));$("#cboTimeEndMinute").val(b.data.time_end.substr(3,2));$("#txtDateOver").val(b.data.date_over);$("#overtimeId").val(b.data.overtime_id);$("#cobProject").val(b.data.project_id);$("#btnOverTimeUpdate").prop("disabled","");$("#txtOverTimeDesc").focus();$("#cobEmpId").val(b.data.emp_id);recalculateTime();updateProcess=true;getShiftHour()}else{showDialog("System Message",b.mesg)}}function onOverTimeResponse(d,c){if(c.status==C_OK){if(c.type=="emp"){$("#overtime_emp_id").show();$("#overtime_emp_id").text(c.data)}else{if(c.type==C_GET+"_EMP"){var h=c.data.empList;var j=h.split("|");var b="";var a="";for(var e=0;e<j.length;e++){b=j[e].split(":");a+="<option value='"+b[0]+"'>"+b[1]+"</option>"}$("#cobEmpId").html(a)}else{if(c.type=="shifthour"){if(!updateProcess){$("#cboTimeStartHour").val(c.data.start.substr(0,2));$("#cboTimeStartMinute").val(c.data.start.substr(3,2));$("#cboTimeEndHour").val(c.data.end.substr(0,2));$("#cboTimeEndMinute").val(c.data.end.substr(3,2));$("#inpOTStart").val(0);$("#inpOTEnd").val(0);$("#inpLateIn").val(0);$("#inpEarlyOut").val(0)}$("#inpShiftStart").val(c.data.start.substr(0,5));$("#inpShiftEnd").val(c.data.end.substr(0,5));$("#tolerance").val(c.data.tolerance);$("#limit_before").val(c.data.limit_before);$("#limit_after").val(c.data.limit_after);if(updateProcess){recalculateTime()}updateProcess=false}else{if(c.type=="LIST"){var f='<tr><td style="width:30px;height:1px"></td><td style="width:100px"></td><td style="width:80px"></td><td style="width:20px;display:none"></td><td style="width:80px"></td><td style="width:20px;display: none"></td><td style="width:50px"></td><td style="width:50px"></td><td style="width:50px"></td><td style="width:150px"></td><td style="width:25px"></td><td style="width:25px"></td></tr>';$("#sbg-overtime-table").html(f+c.data)}else{if(c.type==C_ADD){var g=$("#txtDateOver").val().substr(6,4)+$("#txtDateOver").val().substr(3,2)+$("#txtDateOver").val().substr(0,2);$("#sbg-overtime-table tr:first").after("<tr><td>"+$("#cobEmpId").val()+"</td><td>"+$("#cobEmpId :selected").text()+"</td><td>"+$("#txtDateOver").val()+'</td><td style="display:none">'+$("#cobProject").val()+"</td><td>"+$("#cobProject :selected").text()+'</td><td style="display: none">'+c.data+"</td><td>"+$("#cboTimeStartHour").val()+":"+$("#cboTimeStartMinute").val()+"</td><td>"+$("#cboTimeEndHour").val()+":"+$("#cboTimeEndMinute").val()+"</td><td>"+$("#txtOTHour").val()+"</td><td>"+$("#txtOverTimeDesc").val()+"</td><td style='text-align:center'><a href='javascript:' onclick='editOverTime("+$("#cobEmpId").val()+", "+g+", "+c.data+", this)'><img src='image/edit_16.png' title='Edit'></img></a></td><td style='text-align:center'><a href='javascript:' onclick='deleteOverTime("+$("#cobEmpId").val()+", "+g+", "+c.data+",this)'><img src='image/delete_16.png' title='Delete'></img></a></td></tr>")}else{if(c.type==C_DELETE){$($(d).closest("tr")).remove()}else{if(c.type==C_UPDATE){var g=$("#txtDateOver").val().substr(6,4)+$("#txtDateOver").val().substr(3,2)+$("#txtDateOver").val().substr(0,2);$($(d).closest("tr")).children("td:eq(0)").html($("#cobEmpId").val());$($(d).closest("tr")).children("td:eq(1)").html($("#cobEmpId :selected").text());$($(d).closest("tr")).children("td:eq(2)").text($("#txtDateOver").val());$($(d).closest("tr")).children("td:eq(3)").text($("#cobProject").val());$($(d).closest("tr")).children("td:eq(4)").text($("#cobProject :selected").text());$($(d).closest("tr")).children("td:eq(5)").text($("#overtimeId").val());$($(d).closest("tr")).children("td:eq(6)").html($("#cboTimeStartHour").val()+":"+$("#cboTimeStartMinute").val());$($(d).closest("tr")).children("td:eq(7)").html($("#cboTimeEndHour").val()+":"+$("#cboTimeEndMinute").val());$($(d).closest("tr")).children("td:eq(8)").html($("#txtOTHour").val());$($(d).closest("tr")).children("td:eq(9)").text($("#txtOverTimeDesc").val())}}}$("#sbg-popup-box").html(c.mesg);$("#sbg-popup-box").show();$("#sbg-popup-box").fadeOut(10000);clearOverTime()}}}}}else{if(c.type=="emp"){$("#txtEmpId").focus();$("#overtime_emp_id").text("Invalid employee ID.")}else{showDialog("System Message",c.mesg)}}}function validateOverTime(){if(isNaN($("#cobEmpId").val())){showDialog("Error","Employee id can not be blank.");$("#cobEmpId").focus();return false}$("#overtime_err_mesg").text("");alert($("#txtOverTimeDesc").val());if($("#txtOverTimeDesc").blank()){$("#overtime_err_desc").show();$("#txtOverTimeDesc").focus();$("#overtime_err_mesg").text("Over time description can not be blank.");return false}else{$("#overtime_err_desc").hide()}var c=new Date(2000,0,1,parseInt($("#cboTimeStartHour").val()),parseInt($("#cboTimeStartMinute").val()));var a=new Date(2000,0,1,parseInt($("#cboTimeEndHour").val()),parseInt($("#cboTimeEndMinute").val()));var b=a-c;var d=Math.floor(b/1000/60);if(d>0){}else{$("#overtime_err_desc").show();$("#cboTimeStartHour").focus();$("#overtime_err_mesg").text("Over time description can not be blank.");return false}return true}function getShiftHour(){if($("#txtDateOver").val()!=""){var b={type:"shifthour",empId:$("#cobEmpId").val(),date:$("#txtDateOver").val()};var a="request.pzx?c="+attendance_url+"&d="+new Date().getTime();callServer(a,"json",b,onOverTimeResponse,overtime_obj)}else{$("#shiftHourMsg").hide();$("#shiftHourMsg").text("")}}function getList(){var b={type:"LIST",date_start:$("#txtPeriodStart").val(),date_end:$("#txtPeriodEnd").val()};var a="request.pzx?c="+overtime_url+"&d="+new Date().getTime();callServer(a,"json",b,onOverTimeResponse,overtime_obj)}function populateEmployee(){$dept_id=$("#cobDept").val();var b={type:C_GET+"_EMP",id:$dept_id};var a="request.pzx?c="+overtime_url+"&d="+new Date().getTime();callServer(a,"json",b,onOverTimeResponse,overtime_obj)};