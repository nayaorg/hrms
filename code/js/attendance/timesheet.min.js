var timesheet_obj=null;$(document).ready(function(){$("input").css("marginTop",0);$("input").css("marginBottom",0);$("select").css("marginTop",0);$("select").css("marginBottom",0);var a={dateFormat:"dd/mm/yy",appendText:"  dd/mm/yyyy",showOn:"button",buttonImage:"image/calendar.gif",buttonImageOnly:true};$("#txtTSStart").datepicker(a);$("#txtTSExpiry").datepicker(a);$("#btnTSClear").button().bind("click",clearTS);$("#btnTSUpdate").button().bind("click",updateTS);$("#btnTSAdd").button().bind("click",addTS);$("#btnTSPrint").button().bind("click",printTS);$("#timesheet-tabs").tabs();$("#txtTSName").focus();$(window).resize(resizeTSGrid);resizeTSGrid();clearTS()});function resizeTSGrid(){var a=$("#sbg-center-panel").outerHeight()-$("#sbg-timesheet-entry").outerHeight()-55;$("div#sbg-timesheet-data").css("height",a+"px")}function clearTS(){$("#txtTSId").val("Auto");$("#txtTSDesc").val("");$("#txtTSRef").val("");$("#txtTSStart").val("");$("#txtTSExpiry").val("");$("#cobTSEmp").val("");$("#cobTSProj").val("");$("#cobTSAct").val("");$("#timesheet-tabs").tabs("option","active",0);$("#txtUserName").focus();$("#btnUserUpdate").prop("disabled","disabled");$("#cbBillable").prop("checked",false);$("#timesheet_err_name").hide();$("#timesheet_err_full").hide();$("#timesheet_err_group").hide();$("#timesheet_err_mesg").text("");timesheet_obj=null}function updateTS(){saveTS(C_UPDATE)}function addTS(){saveTS(C_ADD)}function saveTS(c){if(validateTS()){var a="0";if($("#cbBillable").is(":checked")){a="1"}var d={type:c,id:$("#txtTSId").val(),empid:$("#cobTSEmp").val(),desc:$("#txtTSDesc").val(),refno:$("#txtTSRef").val(),start:$("#txtTSStart").val(),expiry:$("#txtTSExpiry").val(),billable:a,project:$("#cobTSProj").val(),activity:$("#cobTSAct").val()};var b="request.pzx?c="+timesheet_url+"&d="+new Date().getTime();callServer(b,"json",d,onTSResponse,timesheet_obj)}}function printTS(){var a="report.pzx?c="+timesheet_url+"&d="+new Date().getTime();showReport(a)}function editTS(d,c){var b={type:C_GET,id:d};var a="request.pzx?c="+timesheet_url+"&d="+new Date().getTime();timesheet_obj=c;callServer(a,"json",b,showTS,c)}function deleteTS(d,c){if(confirm("Confirm you want to delete timesheet id : "+d+"?")){var b={type:C_DELETE,id:d};var a="request.pzx?c="+timesheet_url+"&d="+new Date().getTime();callServer(a,"json",b,onTSResponse,c)}}function showTS(a,b){if(b.status==C_OK){$("#txtTSId").val(b.data.id);$("#txtTSDesc").val(b.data.desc);$("#txtTSRef").val(b.data.refno);$("#cobTSEmp").val(b.data.empid);$("#cobTSProj").val(b.data.project);$("#cobTSAct").val(b.data.activity);$("#txtTSStart").val(b.data.start);$("#txtTSExpiry").val(b.data.expiry);if(b.data.billable=="1"){$("#cbBillable").prop("checked",true)}$("#btnUserUpdate").prop("disabled","");$("#txtUserName").focus()}else{showDialog("System Message",b.mesg)}}function onTSResponse(a,b){if(b.status==C_OK){if(b.type==C_ADD){$("#sbg-timesheet-table tr:first").after("<tr><td>"+b.data+"</td><td>"+$("#txtTSDesc").val()+"</td><td>"+$("#cobTSProj :selected").text()+"</td><td>"+$("#cobTSAct :selected").text()+"</td><td style='text-align:center'><a href='javascript:' onclick='editTS("+b.data+",this)'><img src='image/edit_16.png' title='Edit'></img></a></td><td style='text-align:center'><a href='javascript:' onclick='deleteTS("+b.data+",this)'><img src='image/delete_16.png' title='Delete'></img></a></td></tr>")}else{if(b.type==C_DELETE){$($(a).closest("tr")).remove()}else{if(b.type==C_UPDATE){$($(a).closest("tr")).children("td:eq(1)").text($("#txtTSDesc").val());$($(a).closest("tr")).children("td:eq(2)").text($("#cobTSProj :selected").text());$($(a).closest("tr")).children("td:eq(3)").text($("#cobTSAct :selected").text())}}}$("#sbg-popup-box").html(b.mesg);$("#sbg-popup-box").show();$("#sbg-popup-box").fadeOut(5000);clearTS()}else{showDialog("Error",b.mesg)}}function validateTS(){$("#timesheet_err_mesg").text("");if($("#txtTSDesc").blank()){$("#timesheet_err_desc").show();$("#txtTSDesc").focus();$("#timesheet_err_mesg").text("Description can not be blank.");return false}else{$("#timesheet_err_desc").hide()}if($("#cobTSProj").val()==""){$("#timesheet_err_project").show();$("#cobTSProj").focus();$("#timesheet_err_mesg").text("You must pick a project to this timesheet");return false}else{$("#timesheet_err_project").hide()}if($("#cobTSAct").val()==""){$("#timesheet_err_activity").show();$("#cobTSAct").focus();$("#timesheet_err_mesg").text("You must pick an activity to this timesheet");return false}else{$("#timesheet_err_project").hide()}return true};