var time_card_obj=null;$("#btnTimeCardClear").button().bind("click",clearTimeCard);$("#btnTimeCardUpdate").button().bind("click",updateTimeCard);$("#btnTimeCardAdd").button().bind("click",addTimeCard);$("#btnTimeCardPrint").button().bind("click",printTimeCard);$("#timecard-tabs").tabs();$("#txtTimeCardDesc").focus();$(window).resize(resizeTimeCardGrid);resizeTimeCardGrid();var TimeStart=document.getElementById("cboTimeStartHour");var TimeEnd=document.getElementById("cboTimeEndHour");var BreakStart=document.getElementById("cboBreakStartHour");var BreakEnd=document.getElementById("cboBreakEndHour");for(var i=0;i<=23;++i){var option=document.createElement("option");var option2=document.createElement("option");var option3=document.createElement("option");var option4=document.createElement("option");var StrOp="";if(i<10){StrOp="0"}StrOp+=""+i;option.text=option.value=StrOp;option2.text=option2.value=StrOp;option3.text=option3.value=StrOp;option4.text=option4.value=StrOp;TimeStart.add(option,0);TimeEnd.add(option2,0);BreakStart.add(option3,0);BreakEnd.add(option4,0)}var TimeStart=document.getElementById("cboTimeStartMinute");var TimeEnd=document.getElementById("cboTimeEndMinute");var BreakStart=document.getElementById("cboBreakStartMinute");var BreakEnd=document.getElementById("cboBreakEndMinute");for(var i=0;i<=59;++i){var option=document.createElement("option");var option2=document.createElement("option");var option3=document.createElement("option");var option4=document.createElement("option");var StrOp="";if(i<10){StrOp="0"}StrOp+=""+i;option.text=option.value=StrOp;option2.text=option2.value=StrOp;option3.text=option3.value=StrOp;option4.text=option4.value=StrOp;TimeStart.add(option,0);TimeEnd.add(option2,0);BreakStart.add(option3,0);BreakEnd.add(option4,0)}clearTimeCard();function resizeTimeCardGrid(){var a=$("#sbg-center-panel").outerHeight()-$("#sbg-timecard-entry").outerHeight()-55;$("div#sbg-timecard-data").css("height",a+"px")}function clearTimeCard(){$("#txtTimeCardId").val("Auto");$("#txtTimeCardDesc").val("");$("#txtTimeCardRef").val("");$("#inpTolerance").val(0);$("#cboTimeStartHour").val("00");$("#cboTimeStartMinute").val("00");$("#cboTimeEndHour").val("00");$("#cboTimeEndMinute").val("00");$("#cboBreakStartHour").val("00");$("#cboBreakStartMinute").val("00");$("#cboBreakEndHour").val("00");$("#cboBreakEndMinute").val("00");$("#timecard-tabs").tabs("option","active",0);$("#txtTimeCardDesc").focus();$("#btnTimeCardUpdate").prop("disabled","disabled");$("#timecard_err_mesg").text("");$("#timecard_err_desc").hide();timecard_obj=null}function updateTimeCard(){saveTimeCard(C_UPDATE)}function addTimeCard(){saveTimeCard(C_ADD)}function saveTimeCard(b){if(validateTimeCard()){var c={type:b,id:$("#txtTimeCardId").val(),desc:$("#txtTimeCardDesc").val(),refno:$("#txtTimeCardRef").val(),time_break:0,tolerance:$("#inpTolerance").val(),time_start:$("#cboTimeStartHour").val()+":"+$("#cboTimeStartMinute").val(),time_end:$("#cboTimeEndHour").val()+":"+$("#cboTimeEndMinute").val(),break_start:$("#cboBreakStartHour").val()+":"+$("#cboBreakStartMinute").val(),break_end:$("#cboBreakEndHour").val()+":"+$("#cboBreakEndMinute").val()};var a="request.pzx?c="+timecard_url+"&d="+new Date().getTime();callServer(a,"json",c,onTimeCardResponse,timecard_obj)}}function printTimeCard(){var a="report.pzx?c="+timecard_url+"&d="+new Date().getTime();showReport(a)}function editTimeCard(d,c){var b={type:C_GET,id:d};var a="request.pzx?c="+timecard_url+"&d="+new Date().getTime();timecard_obj=c;callServer(a,"json",b,showTimeCard,c)}function deleteTimeCard(d,c){if(confirm("Confirm you want to delete time card id : "+d+"?")){var b={type:C_DELETE,id:d};var a="request.pzx?c="+timecard_url+"&d="+new Date().getTime();callServer(a,"json",b,onTimeCardResponse,c)}}function showTimeCard(a,b){if(b.status==C_OK){$("#txtTimeCardId").val(b.data.id);$("#txtTimeCardDesc").val(b.data.desc);$("#txtTimeCardRef").val(b.data.refno);$("#inpTolerance").val(b.data.tolerance);$("#cboTimeStartHour").val(b.data.time_start.substr(0,2));$("#cboTimeStartMinute").val(b.data.time_start.substr(3,2));$("#cboTimeEndHour").val(b.data.time_end.substr(0,2));$("#cboTimeEndMinute").val(b.data.time_end.substr(3,2));$("#cboBreakStartHour").val(b.data.break_start.substr(0,2));$("#cboBreakStartMinute").val(b.data.break_start.substr(3,2));$("#cboBreakEndHour").val(b.data.break_end.substr(0,2));$("#cboBreakEndMinute").val(b.data.break_end.substr(3,2));$("#btnTimeCardUpdate").prop("disabled","");$("#txtTimeCardDesc").focus()}else{showDialog("System Message",b.mesg)}}function onTimeCardResponse(a,b){if(b.status==C_OK){if(b.type==C_ADD){$("#sbg-timecard-table tr:first").after("<tr><td>"+b.data+"</td><td>"+$("#txtTimeCardDesc").val()+"</td><td>"+$("#txtTimeCardRef").val()+"</td><td>"+$("#cboTimeStartHour").val()+":"+$("#cboTimeStartMinute").val()+"</td><td>"+$("#cboTimeEndHour").val()+":"+$("#cboTimeEndMinute").val()+"</td><td style='text-align:center'><a href='javascript:' onclick='editTimeCard("+b.data+",this)'><img src='image/edit_16.png' title='Edit'></img></a></td><td style='text-align:center'><a href='javascript:' onclick='deleteTimeCard("+b.data+",this)'><img src='image/delete_16.png' title='Delete'></img></a></td></tr>")}else{if(b.type==C_DELETE){$($(a).closest("tr")).remove()}else{if(b.type==C_UPDATE){$($(a).closest("tr")).children("td:eq(1)").html($("#txtTimeCardDesc").val());$($(a).closest("tr")).children("td:eq(2)").text($("#txtTimeCardRef").val());$($(a).closest("tr")).children("td:eq(3)").html($("#cboTimeStartHour").val()+":"+$("#cboTimeStartMinute").val());$($(a).closest("tr")).children("td:eq(4)").html($("#cboTimeEndHour").val()+":"+$("#cboTimeEndMinute").val())}}}$("#sbg-popup-box").html(b.mesg);$("#sbg-popup-box").show();$("#sbg-popup-box").fadeOut(10000);clearTimeCard()}else{showDialog("Error",b.mesg)}}function validateTimeCard(){$("#timecard_err_mesg").text("");if($("#txtTimeCardDesc").blank()){$("#timecard_err_desc").show();$("#txtTimeCardDesc").focus();$("#timecard_err_mesg").text("time card description can not be blank.");return false}else{$("#time_card_err_desc").hide()}return true};