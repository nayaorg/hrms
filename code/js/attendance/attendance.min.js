var attendance_obj=null;var updateProcess=false;$(document).ready(function(){var c={dateFormat:"dd/mm/yy",appendText:"  dd/mm/yyyy",showOn:"button",buttonImage:"image/calendar.gif",buttonImageOnly:true};var n={dateFormat:"dd/mm/yy",showOn:"button",buttonImage:"image/calendar.gif",buttonImageOnly:true};var g={dateFormat:"dd/mm/yy",appendText:"  dd/mm/yyyy",showOn:"button",buttonImage:"image/calendar.gif",buttonImageOnly:true};$("#txtDateAttendance").datepicker(c);$("#txtPeriodStart").datepicker(n);$("#txtPeriodEnd").datepicker(g);$("#btnAttendanceClear").button().bind("click",clearAttendance);$("#btnAttendanceUpdate").button().bind("click",updateAttendance);$("#btnAttendanceAdd").button().bind("click",addAttendance);$("#btnAttendancePrint").button().bind("click",printAttendance);$("#btnAttendanceApply").button().bind("click",getList);$("#btnAttendanceInputControl").button().bind("click",showInput);$("#btnAttendanceHide").button().bind("click",hideInput);$("#cobDept").change(populateEmployee);$("#attendance-tabs").tabs();$("#txtAttendanceDesc").focus();$(window).resize(resizeAttendanceGrid);resizeAttendanceGrid();getList();var b=document.getElementById("cboTimeStartHour");var d=document.getElementById("cboTimeEndHour");var h=document.getElementById("cboBreakStartHour");var a=document.getElementById("cboBreakEndHour");for(var e=0;e<=23;++e){var f=document.createElement("option");var l=document.createElement("option");var k=document.createElement("option");var j=document.createElement("option");var m="";if(e<10){m="0"}m+=""+e;f.text=f.value=m;l.text=l.value=m;k.text=k.value=m;j.text=j.value=m;b.add(f,0);d.add(l,0);h.add(k,0);a.add(j,0)}var b=document.getElementById("cboTimeStartMinute");var d=document.getElementById("cboTimeEndMinute");var h=document.getElementById("cboBreakStartMinute");var a=document.getElementById("cboBreakEndMinute");for(var e=0;e<=59;++e){var f=document.createElement("option");var l=document.createElement("option");var k=document.createElement("option");var j=document.createElement("option");var m="";if(e<10){m="0"}m+=""+e;f.text=f.value=m;l.text=l.value=m;k.text=k.value=m;j.text=j.value=m;b.add(f,0);d.add(l,0);h.add(k,0);a.add(j,0)}$("#sbg-attendance-entry").hide();clearAttendance()});function hideInput(){$("#sbg-attendance-entry").hide("slow")}function showInput(){$("#sbg-attendance-entry").show("slow")}function resizeAttendanceGrid(){var a=$("#sbg-center-panel").outerHeight()-$("#sbg-attendance-entry").outerHeight()-55;$("div#sbg-attendance-data").css("height",a+"px")}function clearAttendance(){$("#txtDateAttendance").val("");$("#cobDept").val("");populateEmployee();$("#cboTimeStartHour").val("00");$("#cboTimeStartMinute").val("00");$("#cboTimeEndHour").val("00");$("#cboTimeEndMinute").val("00");$("#cboBreakStartHour").val("00");$("#cboBreakStartMinute").val("00");$("#cboBreakEndHour").val("00");$("#cboBreakEndMinute").val("00");$("#inpShiftStart").val("--:--");$("#inpShiftEnd").val("--:--");$("#inpOTStart").val(0);$("#inpOTEnd").val(0);$("#inpLateIn").val(0);$("#inpEarlyOut").val(0);$("#cobProject").val("");$("#seq_number").val(-1);var b=new Date();var a=b.getDate();var c=b.getMonth()+1;var d=b.getFullYear();if(a<10){a="0"+a}if(c<10){c="0"+c}$("#Attendance-tabs").tabs("select",0);$("#cobEmpId").focus();$("#btnAttendanceUpdate").prop("disabled","disabled");$("#attendance_err_mesg").text("");$("#attendance_err_desc").hide();$("#attendance_emp_id").text("");$("#attendance_emp_id").show();$("#cobEmpId").val("");$("#cobDept").prop("disabled","");$("#cobEmpId").prop("disabled","");$("#txtDateAttendance").prop("disabled","");attendance_obj=null}function recalculateTime(){if($("#inpShiftStart").val()!="--:--"){var m;var b;var d;var j=0;var g=0;var c=0;var o=0;var n=new Date(2000,0,1,parseInt($("#inpShiftStart").val().substr(0,2)),parseInt($("#inpShiftStart").val().substr(3,2)));var l=new Date(2000,0,1,parseInt($("#inpShiftEnd").val().substr(0,2)),parseInt($("#inpShiftEnd").val().substr(3,2)));var f=new Date(2000,0,1,parseInt($("#cboTimeStartHour").val()),parseInt($("#cboTimeStartMinute").val()));var e=new Date(2000,0,1,parseInt($("#cboTimeEndHour").val()),parseInt($("#cboTimeEndMinute").val()));var i=new Date(2000,0,1,parseInt($("#cboBreakStartHour").val()),parseInt($("#cboBreakStartMinute").val()));var k=new Date(2000,0,1,parseInt($("#cboBreakEndHour").val()),parseInt($("#cboBreakEndMinute").val()));var p=parseInt($("#limit_before").val());var a=parseInt($("#limit_after").val());var h=parseInt($("#tolerance").val());if(f>n){m=f-n;b=Math.floor(m/1000/60);if(b>h){j=j+(b-h)}}else{m=n-f;b=Math.floor(m/1000/60);b=(b<h)?0:b-h;c=c+((b>p*60)?(p*60):b)}if(e<l){m=l-e;b=Math.floor(m/1000/60);if(b>h){g=g+(b-h)}}else{m=e-l;b=Math.floor(m/1000/60);b=(b<h)?0:b-h;o=o+(((b>a*60)?(a*60):b))}$("#inpOTStart").val(c);$("#inpOTEnd").val(o);$("#inpLateIn").val(j);$("#inpEarlyOut").val(g)}}function updateAttendance(){saveAttendance(C_UPDATE)}function addAttendance(){saveAttendance(C_ADD)}function saveAttendance(b){if(validateAttendance()){var c={type:b,emp_id:$("#cobEmpId").val(),date:$("#txtDateAttendance").val(),project_id:$("#cobProject").val(),seq_number:$("#seq_number").val(),time_start:$("#cboTimeStartHour").val()+":"+$("#cboTimeStartMinute").val(),time_end:$("#cboTimeEndHour").val()+":"+$("#cboTimeEndMinute").val(),break_start:$("#cboBreakStartHour").val()+":"+$("#cboBreakStartMinute").val(),break_end:$("#cboBreakEndHour").val()+":"+$("#cboBreakEndMinute").val(),ot_start:$("#inpOTStart").val(),ot_end:$("#inpOTEnd").val(),shift_start:$("#inpShiftStart").val(),shift_end:$("#inpShiftEnd").val(),limit_before:$("#limit_before").val(),limit_after:$("#limit_after").val(),tolerance:$("#tolerance").val(),late_in:$("#inpLateIn").val(),early_out:$("#inpEarlyOut").val()};var a="request.pzx?c="+attendance_url+"&d="+new Date().getTime();callServer(a,"json",c,onAttendanceResponse,attendance_obj)}}function printAttendance(){var a="report.pzx?c="+attendance_url+"&d="+new Date().getTime()+"&dt="+$("#txtPeriodStart").val()+"&dtend="+$("#txtPeriodEnd").val();showReport(a)}function editAttendance(f,c,b,e){$("#cobDept").val("");populateEmployee();var d={type:C_GET,id:f,date_attendance:c,seq_number:b};var a="request.pzx?c="+attendance_url+"&d="+new Date().getTime();attendance_obj=e;callServer(a,"json",d,showAttendance,e)}function deleteAttendance(f,c,b,e){if(confirm("Confirm you want to delete attendance for employee id : "+f+"?")){var d={type:C_DELETE,id:f,date_attendance:c,seq_number:b};var a="request.pzx?c="+attendance_url+"&d="+new Date().getTime();callServer(a,"json",d,onAttendanceResponse,e)}}function showAttendance(a,b){if(b.status==C_OK){showInput();$("#txtDateAttendance").val(b.data.date);$("#cobProject").val(b.data.project_id);$("#seq_number").val(b.data.seq_number);$("#cboTimeStartHour").val(b.data.time_start.substr(0,2));$("#cboTimeStartMinute").val(b.data.time_start.substr(3,2));$("#cboTimeEndHour").val(b.data.time_end.substr(0,2));$("#cboTimeEndMinute").val(b.data.time_end.substr(3,2));$("#cboBreakStartHour").val(b.data.break_start.substr(0,2));$("#cboBreakStartMinute").val(b.data.break_start.substr(3,2));$("#cboBreakEndHour").val(b.data.break_end.substr(0,2));$("#cboBreakEndMinute").val(b.data.break_end.substr(3,2));updateProcess=true;$("#cobEmpId").val(b.data.emp_id);getShiftHour();$("#btnAttendanceUpdate").prop("disabled","");$("#cobDept").prop("disabled","disabled");$("#cobEmpId").prop("disabled","disabled");$("#txtDateAttendance").prop("disabled","disabled");$("#txtAttendanceDesc").focus()}else{showDialog("System Message",b.mesg)}}function onAttendanceResponse(e,d){if(d.status==C_OK){if(d.type=="emp"){$("#attendance_emp_id").show();$("#attendance_emp_id").text(d.data.name);$("#shiftType").val(d.data.shiftType);$("#shiftGroupID").val(d.data.shiftGroup)}else{if(d.type==C_GET+"_EMP"){var h=d.data.empList;var j=h.split("|");var c="";var a="";for(var f=0;f<j.length;f++){c=j[f].split(":");a+="<option value='"+c[0]+"'>"+c[1]+"</option>"}$("#cobEmpId").html(a)}else{if(d.type=="shifthour"){if(!updateProcess){$("#cboTimeStartHour").val(d.data.start.substr(0,2));$("#cboTimeStartMinute").val(d.data.start.substr(3,2));$("#cboTimeEndHour").val(d.data.end.substr(0,2));$("#cboTimeEndMinute").val(d.data.end.substr(3,2));$("#cboBreakStartHour").val(d.data.break_start.substr(0,2));$("#cboBreakStartMinute").val(d.data.break_start.substr(3,2));$("#cboBreakEndHour").val(d.data.break_end.substr(0,2));$("#cboBreakEndMinute").val(d.data.break_end.substr(3,2));$("#inpOTStart").val(0);$("#inpOTEnd").val(0);$("#inpLateIn").val(0);$("#inpEarlyOut").val(0)}$("#inpShiftStart").val(d.data.start.substr(0,5));$("#inpShiftEnd").val(d.data.end.substr(0,5));$("#tolerance").val(d.data.tolerance);$("#limit_before").val(d.data.limit_before);$("#limit_after").val(d.data.limit_after);if(updateProcess){recalculateTime()}updateProcess=false}else{if(d.type=="LIST"){var g='<tr><td style="width:50px;height:1px"></td><td style="width:150px"></td><td style="width:100px"></td><td style="width:100px"></td><td style="width:50px;display:none"></td><td style="width:50px;display:none"></td><td style="width:50px"></td><td style="width:50px"></td><td style="width:50px"></td><td style="width:50px"></td><td style="width:25px"></td><td style="width:25px"></td></tr>';$("#sbg-attendance-table").html(g+d.data)}else{if(d.type==C_ADD){var b=$("#txtDateAttendance").val().substr(6,4)+$("#txtDateAttendance").val().substr(3,2)+$("#txtDateAttendance").val().substr(0,2);$("#sbg-attendance-table tr:first").after("<tr><td>"+$("#cobEmpId").val()+"</td><td>"+$("#cobEmpId :selected").text()+"</td><td>"+$("#txtDateAttendance").val()+"</td><td>"+$("#cobProject :selected").text()+'</td><td style="display:none">'+$("#cobProject").val()+'</td><td style="display:none">'+d.data+"</td><td>"+$("#cboTimeStartHour").val()+":"+$("#cboTimeStartMinute").val()+"</td><td>"+$("#cboTimeEndHour").val()+":"+$("#cboTimeEndMinute").val()+"</td><td>"+$("#cboBreakStartHour").val()+":"+$("#cboBreakStartMinute").val()+"</td><td>"+$("#cboBreakEndHour").val()+":"+$("#cboBreakEndMinute").val()+"</td><td style='text-align:center'><a href='javascript:' onclick='editAttendance("+$("#cobEmpId").val()+", "+b+",this)'><img src='image/edit_16.png' title='Edit'></img></a></td><td style='text-align:center'><a href='javascript:' onclick='deleteAttendance("+$("#cobEmpId").val()+", "+b+",this)'><img src='image/delete_16.png' title='Delete'></img></a></td></tr>")}else{if(d.type==C_DELETE){$($(e).closest("tr")).remove()}else{if(d.type==C_UPDATE){$($(e).closest("tr")).children("td:eq(0)").html($("#cobEmpId").val());$($(e).closest("tr")).children("td:eq(1)").html($("#cobEmpId :selected").text());$($(e).closest("tr")).children("td:eq(2)").text($("#txtDateAttendance").val());$($(e).closest("tr")).children("td:eq(3)").text($("#cobProject :selected").text());$($(e).closest("tr")).children("td:eq(4)").text($("#cobProject").val());$($(e).closest("tr")).children("td:eq(5)").text($("#seq_number").val());$($(e).closest("tr")).children("td:eq(6)").html($("#cboTimeStartHour").val()+":"+$("#cboTimeStartMinute").val());$($(e).closest("tr")).children("td:eq(7)").html($("#cboTimeEndHour").val()+":"+$("#cboTimeEndMinute").val());$($(e).closest("tr")).children("td:eq(8)").html($("#cboBreakStartHour").val()+":"+$("#cboBreakStartMinute").val());$($(e).closest("tr")).children("td:eq(9)").html($("#cboBreakEndHour").val()+":"+$("#cboBreakEndMinute").val())}}}$("#sbg-popup-box").html(d.mesg);$("#sbg-popup-box").show();$("#sbg-popup-box").fadeOut(10000);clearAttendance()}}}}}else{if(d.type=="emp"){$("#attendance_emp_id").show();$("#attendance_emp_id").text("Invalid employee ID.")}else{showDialog("System Message",d.mesg)}}}function validateAttendance(){if(isNaN($("#cobEmpId").val())){showDialog("Error","Employee id can not be blank.");$("#cobEmpId").focus();return false}$("#attendance_err_mesg").text("");if($("#cobProject").val()==0){showDialog("Error","Project can not be blank.");$("#cobProject").focus();return false}return true}function getEmpId(){if($("#txtEmpId").val()!=""){if(isNaN($("#txtEmpId").val())){$("#attendance_emp_id").show();$("#attendance_emp_id").text("Invalid employee ID.")}else{var b={type:"emp",id:$("#txtEmpId").val()};var a="request.pzx?c="+attendance_url+"&d="+new Date().getTime();callServer(a,"json",b,onAttendanceResponse,attendance_obj)}}else{$("#attendance_emp_id").text("")}}function getShiftHour(){if($("#txtDateAttendance").val()!=""){var b={type:"shifthour",empId:$("#cobEmpId").val(),date:$("#txtDateAttendance").val()};var a="request.pzx?c="+attendance_url+"&d="+new Date().getTime();callServer(a,"json",b,onAttendanceResponse,attendance_obj)}else{$("#shiftHourMsg").hide();$("#shiftHourMsg").text("")}}function getList(){var b={type:"LIST",date_start:$("#txtPeriodStart").val(),date_end:$("#txtPeriodEnd").val()};var a="request.pzx?c="+attendance_url+"&d="+new Date().getTime();callServer(a,"json",b,onAttendanceResponse,attendance_obj)}function populateEmployee(){$dept_id=$("#cobDept").val();var b={type:C_GET+"_EMP",id:$dept_id};var a="request.pzx?c="+attendance_url+"&d="+new Date().getTime();callServer(a,"json",b,onAttendanceResponse,attendance_obj)};